<html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="UTF-8">

<meta id="ctl00_viewport" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=2.0,user-scalable=no"><title>
	（转载）DIY激光虚拟键盘低成本自制【全面讲解二】
</title><link href="1.css_t_201.css" rel="stylesheet" type="text/css">

    
    <link rel="canonical" href="http://www.360doc.com/content/14/1024/17/8215213_419539379.shtml">
    <meta content="（转载）DIY激光虚拟键盘低成本自制【全面讲解二】" name="description">
    <meta content="摄像头,坐标,激光" name="keywords">

<style>

	.share{float:right;position:relative;width:165px;overflow:hidden;}
	.share-bar-btn a{
	float:left;
	display:block;
	width:55px!important;
	height:40px!important; 
	margin:0!important;
	padding:0!important;
	
	background: url("tb50.png") no-repeat scroll 0% 0% transparent !important;
}
.share-bar-btn2 a
{
    background: url("/images/tb502.png") no-repeat scroll 0% 0% transparent !important;
    }
    .share-bar-btn3 a
{
    background: url("/images/tb503.png") no-repeat scroll 0% 0% transparent !important;
    }
    .share-bar-btn4 a
{
    background: url("/images/tb504.png") no-repeat scroll 0% 0% transparent !important;
    }
    .share-bar-btn5 a
{
    background: url("/images/tb505.png") no-repeat scroll 0% 0% transparent !important;
    }
	.share-bar-btn span{float:left;line-height:28px; color:#999999;}
	.share-bar-btn .bds_qzone{background-position:0 0!important;}
	.share-bar-btn a.bds_qzone:hover{background-position:0 0!important;opacity:1.0!important;filter:alpha(opacity=100)!important;}
	.share-bar-btn .bds_tsina{background-position:0 -41px!important;}
	.share-bar-btn a.bds_tsina:hover{background-position:0 -41px!important;opacity:1.0!important;filter:alpha(opacity=100)!important;}
	.share-bar-btn .bds_tqq{background-position:0 -82px!important;}
	.share-bar-btn a.bds_tqq:hover{background-position:0 -82px!important;opacity:1.0!important;filter:alpha(opacity=100)!important;}
	.share-bar-btn .bds_fxx{background-position:0 -123px!important;}
	.share-bar-btn a.bds_fxx:hover{background-position:0 -123px!important;opacity:1.0!important;filter:alpha(opacity=100)!important;}
</style>

    
<link href="bdsstyle.css_cdnve.css" rel="stylesheet" type="text/css"></head>
<body><iframe style="display: none; " frameborder="0" src="0.htm"></iframe><div id="bdshare_s" style="display: block; "><iframe id="bdsIfr" style="position:absolute;display:none;z-index:9999;" frameborder="0" src="1.htm"></iframe><div id="bdshare_l" style="display: none; "><div id="bdshare_l_c"><h6>分享到</h6><ul><li><a href="8215213_419539379.html#" class="bds_mshare mshare">一键分享</a></li><li><a href="8215213_419539379.html#" class="bds_qzone qqkj">QQ空间</a></li><li><a href="8215213_419539379.html#" class="bds_tsina xlwb">新浪微博</a></li><li><a href="8215213_419539379.html#" class="bds_bdysc bdysc">百度云收藏</a></li><li><a href="8215213_419539379.html#" class="bds_renren rrw">人人网</a></li><li><a href="8215213_419539379.html#" class="bds_tqq txwb">腾讯微博</a></li><li><a href="8215213_419539379.html#" class="bds_bdxc bdxc">百度相册</a></li><li><a href="8215213_419539379.html#" class="bds_kaixin001 kxw">开心网</a></li><li><a href="8215213_419539379.html#" class="bds_tqf txpy">腾讯朋友</a></li><li><a href="8215213_419539379.html#" class="bds_tieba bdtb">百度贴吧</a></li><li><a href="8215213_419539379.html#" class="bds_douban db">豆瓣网</a></li><li><a href="8215213_419539379.html#" class="bds_tsohu shwb">搜狐微博</a></li><li><a href="8215213_419539379.html#" class="bds_bdhome bdhome">百度新首页</a></li><li><a href="8215213_419539379.html#" class="bds_sqq sqq">QQ好友</a></li><li><a href="8215213_419539379.html#" class="bds_thx thx">和讯微博</a></li><li><a href="8215213_419539379.html#" class="bds_more">更多...</a></li></ul><p><a href="8215213_419539379.html#" class="goWebsite">百度分享</a></p></div></div></div>
 
    <header> 
    <div style="display:none;" id="curruseridmaster"></div>
    <div id="ctl00_currentuseridmaster" style="display:none;"></div>
<div class="p_header">
<div class="p_header_logowrap">
<a href="javascript:history.go(-1)" id="ctl00_logopic" class="p_header_fh" onclick="wzhit('wapart1')"></a>
<div class="p_header_nav" id="currsearchdiv">

<a href="javascript:void(0)" class="p_header_dh" id="sousoflag" onclick="wzhit(2);opensearch();">导航</a>
</div>
<div class="p_header_nav" style=" padding-right:20px;" id="curruserlayerdiv">

<a href="javascript:void(0)" class="p_header_ren" onclick="openuserpanel();wzhit(1);" id="userpanel"></a>
</div>
<div class="p_header_nav" style="padding-right: 20px; padding-top: 0px; " id="fontsetup"> <a href="javascript:void(0)" class="p_header_wz" onclick="wzhit('wapart2');openfontsetup();"></a></div>
</div>

<nav>
<ul class="p_nav" id="daohang" style="display: none; ">
<li style=" width:20%;" class="" id="indexindex"><a href="http://www.360doc.cn/" title="首页" onclick="wzhit(5);">首页</a></li>
<li style=" width:25%;" id="indexreadroom" class=""><a href="http://www.360doc.cn/readroom.aspx" title="阅览室" onclick="wzhit(6);">阅览室</a></li>
<li style=" width:20%;" class=""><a href="http://www.360doc.cn/showusers.aspx" title="馆友" onclick="wzhit(7);">馆友</a></li>
<li style="" class=""><a href="http://www.360doc.cn/myindex.aspx" title="我的图书馆" onclick="wzhit(8);">我的图书馆</a></li>
</ul>
</nav>

</div>
</header>
        

    <section>
<div style=" border-top:1px solid #f8f8f8;"><div class="headyin2" style=" height:10px;" id="headyinid"></div></div>

<div style="width:320px;margin:0px auto;">

<!-- 移动站文章页首屏横幅 -->
<ins class="adsbygoogle" style="display:inline-block;width:320px;height:50px" data-ad-client="ca-pub-2340359438634333" data-ad-slot="6615271604" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:50px;margin:0;padding:0;position:relative;visibility:visible;width:320px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:50px;margin:0;padding:0;position:relative;visibility:visible;width:320px;background-color:transparent"><iframe width="320" height="50" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>

</div>
<div id="currbackgroudcolor" style="margin-top:4px;">
<div class="w1" id="upartcolor">
<div id="ctl00_ContentPlaceHolder1_doctitlediv" class="wztit">（转载）DIY激光虚拟键盘低成本自制【全面讲解二】</div>
<div id="ctl00_ContentPlaceHolder1_Div1" style="display:none"></div>
<div style=" padding-top:8px; height:42px;">
<div class="time fl" style=" margin-top:3px;" id="colortime"><span id="ctl00_ContentPlaceHolder1_savedatespan">2014-10-24</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span id="ctl00_ContentPlaceHolder1_resavename" class="name1"><a href="http://www.360doc.cn/userhome.aspx?userid=8215213" onclick="wzhit('wapart20')">江南之杰</a></span><span id="abcd" style="display:none;">&nbsp;&nbsp;|&nbsp;&nbsp;</span></div>
<div class="zhuanfabt fl" id="resavediv" onclick="resavearticle(this)" style="display:none;"><span id="yizhuancang">转藏<span id="resavenumspan"></span></span><span id="resaveflag" style="display:none;"></span></div>
</div>
<div class="article" id="artcontentdiv">
　　本帖最后由 gazelle 于 2013-8-15 10:58 编辑<div style="height:10px;"></div>转载请注明出处：CLK.blog实现过程<div style="height:10px;"></div>器件选择<div style="height:10px;"></div>有前面的原理分析可知，本激光键盘至少需要摄像头、投射键盘画面的激光器以及一字线激光。如下是我选用的器件和参数<div style="height:10px;"></div>元件<div style="height:10px;"></div>核心参数<div style="height:10px;"></div>摄像头<div style="height:10px;"></div>广角镜头，视角&gt;120度<div style="height:10px;"></div>投射键盘画面的激光器<div style="height:10px;"></div>无特殊要求<div style="height:10px;"></div>一字线激光<div style="height:10px;"></div>红外激光器，&gt;50mW<div style="height:10px;"></div>红外带通滤光片<div style="height:10px;"></div>800nm左右光谱带通<div style="height:10px;"></div>对于摄像头，这里一个比较关键的特性是需要采用广角镜头。目前的USB摄像头一般视角在90度左右，这样的摄像头需要在很高处俯视才能拍摄到完整的激光键盘图案，如果想把本投影键盘制作的小巧，则需要采用广角镜头，视角最好在120度以上。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,1)"><img style="max-width:300px;" id="img0" src="46440003_1.jpg"></a></div><div style="height:10px;"></div>图：窄视角的摄像头需要安装在较高的位置<div style="height:10px;"></div>除了镜头外，摄像头本身没有特殊要求，一般市面VGA画质的普通USB摄像头即可满足要求。下图为我采用的镜头和摄像头照片：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,2)"><img style="max-width:300px;" id="img1" src="46440003_2.jpg"></a></div><div style="height:10px;"></div>图：两种不同视角的摄像头镜头，左边为窄视角镜头，右边为广角镜头<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,3)"><img style="max-width:300px;" id="img2" src="46440003_3.jpg"></a></div><div style="height:10px;"></div>图：USB摄像头模组<div style="height:10px;"></div>对投射键盘图案的激光发射器模组前文已经提到，且没有特殊要求。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,4)"><img style="max-width:300px;" id="img3" src="46440003_4.jpg"></a></div><div style="height:10px;"></div>图：选用的激光键盘图案投射模组<div style="height:10px;"></div>对用于测距的激光发射器，只需要使用红外波段的一字线激光器，功率在50mW左右即可。为了安全考虑，不要使用过大功率的激光器。采用红外波段主要为了过滤可见光干扰，简化视觉处理中的兴趣点提取，同时也不会因为手指反射对投射的键盘图案产生干扰。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,5)"><img style="max-width:300px;" id="img4" src="46440003_5.jpg"></a></div><div style="height:10px;"></div>图：选用的红外线型激光器<div style="height:10px;"></div>摄像头改装<div style="height:10px;"></div>在我之前的3D测距仪文章[2]中提到过使用红外激光器配合红外滤光片进行测距可有效避免可见光干扰的技巧，在这里也仍旧适用。对此我们需要对摄像头镜头做一些改造，首先拆除镜头上的红外光截至滤光片，并在镜头头部安装红外带通滤光片：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,6)"><img style="max-width:300px;" id="img5" src="46440003_6.jpg"></a></div><div style="height:10px;"></div>图：拆除镜头内的红外截止滤光片<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,7)"><img style="max-width:300px;" id="img6" src="46440003_7.jpg"></a></div><div style="height:10px;"></div>图：在镜头表面安装红外带通滤光片<div style="height:10px;"></div>电子系统<div style="height:10px;"></div>本制作的电子系统比较简单，仅仅涉及给两个激光发射器供电以及通过USB电缆连接摄像头至主机。并没有采用任何单片机，这样也意味着之前原理部分介绍的算法将完全在PC上实现。这样的优点是大幅降低了制作成本以及制作的难度。如果使用的是免驱动USB摄像头，在PC上使用本激光投影键盘只需要额外运行处理程序即可。不过缺点就是这样的设计无法给手机等不支持USB的设备使用。<div style="height:10px;"></div>由于摄像头已经使用了一条USB电缆，因此这里我们直接通过usb的5V供电来驱动另外2个激光器。电路很简单，如下图所示：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,8)"><img style="max-width:300px;" id="img7" src="46440003_8.jpg"></a></div><div style="height:10px;"></div>可以看到电路的核心就是一个3.3V的LDO芯片而已，可以裁剪一个洞洞板制作：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,9)"><img style="max-width:300px;" id="img8" src="46440003_9.jpg"></a></div><div style="height:10px;"></div>图：使用小块洞洞板制作简易的驱动电路<div style="height:10px;"></div>总体安装<div style="height:10px;"></div>由前面的分析可以得到如下的安装结构：<div style="height:10px;"></div>其中线型激光器需要安装在设备的最底下并紧靠底部，这样可以保证产生的激光平面能够尽可能的靠近桌面平面。在激光器上方安装投射键盘图案的激光模组，他的高度以能够投射出与常规键盘尺寸大小类似的图案来决定。在最顶端安装摄像头，其高度取决于摄像头能够完整拍摄整个键盘图案画面为宜。<div style="height:10px;"></div>我使用一块轻质木材作为安装这3个部件的整体支架：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,10)"><img style="max-width:300px;" id="img9" src="46440003_10.jpg"></a></div><div style="height:10px;"></div>图：将激光器安装在木板最底部，使用热熔胶固定<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,11)"><img style="max-width:300px;" id="img10" src="46440003_11.jpg"></a></div><div style="height:10px;"></div>图：安装图案投射模块和摄像头并点亮<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,12)"><img style="max-width:300px;" id="img11" src="46440003_12.jpg"></a></div><div style="height:10px;"></div>图：在木板背面安装稳压电路板和所有供电连线<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,13)"><img style="max-width:300px;" id="img12" src="46440003_13.jpg"></a></div><div style="height:10px;"></div>图：将木板装入一个牢固的纸盒<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,14)"><img style="max-width:300px;" id="img13" src="46440003_14.jpg"></a></div><div style="height:10px;"></div>图：完成并通电<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,15)"><img style="max-width:300px;" id="img14" src="46440003_15.jpg"></a></div><div style="height:10px;"></div>图：顶部加装一个“保护罩”<div style="height:10px;"></div>最终本制作的实体部分组装完毕，接下来将介绍本制作的重点：视觉算法部分。<div style="height:10px;"></div>3.5. 前期视觉处理<div style="height:10px;"></div>由于本制作的视觉处理部分都在PC上进行，因此我使用了OpenCV[6]库来加速视觉运算代码的开发。在进行原理部分提到的手指尖提取和坐标求解前，需要对摄像头捕获的原始画面做一些前期的处理，方便后续的计算。<div style="height:10px;"></div>3.5.1. 镜头扭曲矫正<div style="height:10px;"></div>由于我们使用了广角镜头，因此摄像头拍摄到的画面会存在比较明显的扭曲，就如下图所示：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,16)"><img style="max-width:300px;" id="img15" src="46440003_16.jpg"></a></div><div style="height:10px;"></div>这样扭曲的画面难以直接进行处理计算出后续需要的坐标信息，因为这种扭曲变换是非线性的。因此这里首先需要对摄像头镜头进行校正。在之前的文章[2]中有对摄像头矫正技术的介绍，这里我仍旧使用matlab的摄像头校正工具[7]进行校正。在OpenCV中也提供了相关函数和工具可以对摄像头校正，不过很多人反映相比matlab的算法，OpenCV函数校正得到的结果略差。<div style="height:10px;"></div>在使用Chessboard图案完整校正后，可使用OpenCV的cvInitUndistortRectifyMap/ cvRemap函数通过校正数据将扭曲的画面重新修正。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,17)"><img style="max-width:300px;" id="img16" src="46440003_17.jpg"></a></div><div style="height:10px;"></div>图：将左侧广角镜头的原始画面进行扭曲修正，得到右侧画面<div style="height:10px;"></div>这里有一点需要注意，在先前的安装阶段我们提到摄像头需要安装红外带通滤光片。但在安装滤光片后，由于可见光都被过滤，因此之后无法再进行上述的镜头校正。因此这部分的校正工作需要先于红外滤光片的安装进行。<div style="height:10px;"></div>3.5.2. 滤波<div style="height:10px;"></div>由于摄像头镜头加装了红外带通滤光片，可见光可以有效地被阻挡，因此在摄像头捕获的画面上基本只含有手指对红外激光的反射。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,18)"><img style="max-width:300px;" id="img17" src="46440003_18.jpg"></a></div><div style="height:10px;"></div>图：红外带通滤光片有效地过滤了可见光干扰<div style="height:10px;"></div>对于这样的画面基本上是可以直接进行后续的视觉处理的，不过一般我们还需要额外进行几个步骤：灰度化、高斯滤波、阈值化、形态学滤波<div style="height:10px;"></div>灰度化即将原先RGB色彩的彩色图像转化成灰度图，因为后续的视觉算法并不关心色彩信息，但需要反射光亮度，使用灰度表示后可以大幅加速处理速度。高斯滤波(Gauss Filter)、阈值化（Threshold）、形态学滤波（Morphology Filter）用于过滤画面中的噪点并且使得反射光斑变得平滑和连贯。如果不熟悉这部分概念，可以参考Digital Image Processing一书[8]。这几步操作在OpenCV中均有对应函数可以实现。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,19)"><img style="max-width:300px;" id="img18" src="46440003_19.jpg"></a></div><div style="height:10px;"></div>图：对图像进行各类滤波处理后的效果<div style="height:10px;"></div>上图展现了经过上述滤波算法后，手指尖激光反光光斑处理后的效果。可以看到，原先光斑外围的反射光干扰以及两个比较靠近的指尖之间“黏连”的光斑已经有效地过滤掉了。通过一系列的滤波过程，使得我们可以很精确的求出指尖的坐标。<div style="height:10px;"></div>3.6. 兴趣点提取<div style="height:10px;"></div>可以使用OpenCV提供的cvFindContours对先前与处理得到的光斑画面进行轮廓提取，进而求解出每个光斑区域在图像中的位置。进一步的，我们通过质心法并以光斑亮度作为权重，可以大致求解出每个指尖中心的大致坐标。虽然这个中心坐标未必真的在指尖中心，但相比简单的以光斑区域中心作为指尖中心的方法要精确很多。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,20)"><img style="max-width:300px;" id="img19" src="46440003_20.jpg"></a></div><div style="height:10px;"></div>图：使用轮廓提取手段提取出来的手指区域坐标<div style="height:10px;"></div>3.7. 手指坐标计算和校正<div style="height:10px;"></div>在得到了手指光斑中心点相对于画面坐标之后，可以通过三角测距的方法，把手指在桌面平面内的坐标P(x,y)求出来。<div style="height:10px;"></div>该过程可以类比在激光3D测距中的算法，如下图所示：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,21)"><img style="max-width:300px;" id="img20" src="46440003_21.jpg"></a></div><div style="height:10px;"></div>图：将指尖坐标求解问题转化成3D激光测距问题<div style="height:10px;"></div>我们可以把兴趣点画面顺时针旋转90度，即将图像的X/Y轴相互交换，并在兴趣点之间连接起直线，如上图(b)所示。就会发现这样的画面就和[2]中进行3D激光测距出现的激光扫描线类似，如上图(c)。因此，我们可以按照[2]中推导的公式，求出画面中每个兴趣点的真实坐标（即以激光器为原点，桌面所在平面的坐标系坐标）<div style="height:10px;"></div>这部分的具体原理和公式推导请参考文章[2]。为了能够进行精确的激光测距，我们也需要和[2]中描述的那样对本制作进行校正。校正方法与[2]一样，可以在投影键盘前方用直尺做测量并进行曲线拟合。<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,22)"><img style="max-width:300px;" id="img21" src="46440003_22.jpg"></a></div><div style="height:10px;"></div>图：对激光测距部分进行校正<div style="height:10px;"></div>经过本轮的运算，我们可以得到先前监测到的兴趣点在桌面平面坐标下的表示，测试坐标值具有了物理意义，均以毫米为单位表示。<div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,23)"><img style="max-width:300px;" id="img22" src="46440003_23.jpg"></a></div><div style="height:10px;"></div>3.8. 按键映射和校正<div style="height:10px;"></div>在得到了以桌面坐标平面表示的指尖坐标P(x,y)后，我们需要再进行校正得到前文提到的映射函数<div style="height:10px;"></div>P' (x,y)=fprojection (P(x,y))<div style="height:10px;"></div>该部分的校正比较容易，可以将手指放置在键盘图案的某几个“按键”上，然后将当前的坐标P(x,y)与所“按”“按键”在键盘图案的坐标P_key (x,y)做一下对比。<div style="height:10px;"></div>理想状态下，每个P(x,y)与对应的P_key (x,y)都偏差了一个固定的位移量D。不过由于校正中会带来误差，每次测量时的偏差量D’与理想的位移量都存在一个误差偏移Derror。即<div style="height:10px;"></div>Pkey (x,y)=P(x,y)+D+ Derror<div style="height:10px;"></div>这里我们就可以采用多次测量，并进行最小二乘拟合的方式，把Derror给消除掉，得到近似于D的一个校正值。因此，这里的映射函数就是：<div style="height:10px;"></div>P' (x,y)=P(x,y)+D<div style="height:10px;"></div>另外这里也需要把键盘图案的坐标事先保存下来。我直接对投影在桌面上的键盘图案进行了测量，并按照如下格式保存在程序当中：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,24)"><img style="max-width:300px;" id="img23" src="46440003_24.jpg"></a></div><div style="height:10px;"></div>图：使用一维数组，保存每个按键中心点的坐标(x,y)，按键的尺寸，以及按键的键值<div style="height:10px;"></div>在有了上述数据后，一方面我们可以使用Kd-tree来快速查找到所按下的按键ID。及前文所说的函数<div style="height:10px;"></div>Key[n]=fmapping (P' (x,y))<div style="height:10px;"></div>这里的f_mapping在我的实现中，就是一个Kd-tree。相比循环查找的O(n)复杂度，Kd-tree可以在O(log(n))的时间复杂度下，找到距离点P’(x,y)最接近的元素，因此非常高效率。<div style="height:10px;"></div>目前OpenCV中提供了Kd-tree的实现，不过我在使用过程中遇到了诸多问题，尤其它可能会导致程序crash，因此我使用了由Martin F. Krafft开发的基于C++模板的Kd-tree实现libkdtree++[9]。<div style="height:10px;"></div>得到键盘图案坐标后的另一个好处是可以在PC上重新绘制出一个软键盘，用于提示当前“按下”的按键，提高使用体验：<div style="height:10px;"></div><div class="imgcenter"><a href="javascript:void(0)" onclick="displayalliamge(46440003,25)"><img style="max-width:300px;" id="img24" src="46440003_25.jpg"></a></div><div style="height:10px;"></div>图：将坐标映射到对应“按下”的按键，并提供视觉反馈
</div>

</div>
<div style="width:320px;margin:0px auto;padding-bottom:10px;padding-top:10px;" id="guanggaopifu">
    
<!-- 移动网站正文下方320*100 -->
<ins class="adsbygoogle" style="display:inline-block;width:320px;height:100px" data-ad-client="ca-pub-2340359438634333" data-ad-slot="3759836802" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:100px;margin:0;padding:0;position:relative;visibility:visible;width:320px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:100px;margin:0;padding:0;position:relative;visibility:visible;width:320px;background-color:transparent"><iframe width="320" height="100" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>

</div>
<div class="w1" id="downartcolor">
<div class="name" style=" min-height:28px;"><div>来自：<span id="ctl00_ContentPlaceHolder1_usernamespan" class="name1"><a id="suoshuuser" href="http://www.360doc.cn/userhome.aspx?userid=8215213" onclick="wzhit('wapart22')">江南之杰</a></span>&nbsp;&nbsp;&gt;<span id="ctl00_ContentPlaceHolder1_filespan" class="lan" onclick="wzhit('wapart23')">《<a href="http://www.360doc.cn/taCategoryArticle.aspx?userid=8215213&amp;cid=18" style="colo:#2d609f">DIY</a>》</span><a href="javascript:void(0)" onclick="wzhit('wapart24')"><img id="addcurrfollow" src="guanzhu.gif" onclick="addfollow()"></a></div></div>
<div style="height:6px;"></div>
<div style=" height:46px;display:none;" id="resaveflowerdiv">
<div class="zcwdtsgbt fl" id="resavemy" onclick="resavearticle(this)">转藏到我的图书馆</div>
<div style=" margin-left:10px;float:left;"><a href="javascript:void(0)"><div class="xianhuabt fl" onclick="sendflower(this)" id="loginflower"><span id="flowertxt">献花</span>（<span id="flowernum">0</span>）</div></a></div>
</div>
<div style=" height:50px; ">
<div class="left">

<!-- Baidu Button BEGIN -->
<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare share-bar-btn" onclick="wzhit(event.srcElement.title)">
<span style="font-size:18px; line-height:40px; color:#1f1f1f;" id="fenxiang">分享到：</span>
<a class="bds_qzone" title="分享到QQ空间" href="8215213_419539379.html#"></a>
<a class="bds_tsina" title="分享到新浪微博" href="8215213_419539379.html#"></a>
<a class="bds_tqq" title="分享到腾讯微博" href="8215213_419539379.html#"></a>
</div>



<!-- Baidu Button END -->
</div>

<div class="fl">
<div class="share-bar-btn" id="sharemail"><div style=" cursor:pointer;"><a class="bds_fxx" href="http://www.360doc.cn/sendfriendmail.aspx?id=419539379" onclick="wzhit('wapart30')"></a></div></div>
</div>

</div>
<div>更多精彩，关注微信号：<span style="color:#2D609F">360doc</span></div>
</div>
</div>
         <div style="padding-top:11px;text-align:center;">
         <a href="http://www.360doc.cn/kehuduan.aspx"><img src="clipper.gif" style="width:320px;"></a>
     </div>
<div class="w1" style="padding-top:14px;">
<div class="lswztit">类似文章</div></div>
<div id="ctl00_ContentPlaceHolder1_relearticle"><a href="http://www.360doc.cn/article/1167234_26155203.html" onclick="wzhit('wapart31')"><div class="listd1">香饽饽博客 ? 实惠好机不可...</div></a><a href="http://www.360doc.cn/article/13058693_298790441.html" onclick="wzhit('wapart31')"><div class="listd2">艺术演出让激光大放异彩</div></a><a href="http://www.360doc.cn/article/11081536_411514483.html" onclick="wzhit('wapart31')"><div class="listd1">红外摄像机五种类型及使用...</div></a><a href="http://www.360doc.cn/article/2942912_51536387.html" onclick="wzhit('wapart31')"><div class="listd2">红外线一体机技术大汇总</div></a><a href="http://www.360doc.cn/article/2942912_99495565.html" onclick="wzhit('wapart31')"><div class="listd1">推荐—日夜两用摄像机的选...</div></a><a href="http://www.360doc.cn/article/7051067_233434516.html" onclick="wzhit('wapart31')"><div class="listd2">尼康18-55是卖掉还是改为红...</div></a></div>
<div id="ctl00_ContentPlaceHolder1_relevantmorediv" style=" padding-top:6px;">
<a href="http://www.360doc.cn/relevant.aspx?id=419539379" id="ctl00_ContentPlaceHolder1_relevantlink" class="p_newsmore" onclick="wzhit('wapart32')">更多类似文章 &gt;&gt;</a></div>
<div class="w1" id="reftitle">
<a name="anchor"></a>
<div class="lswztit " style=" padding-top:26px;">馆友评论（<span id="refnum">0</span>）</div></div>
<div id="refinfolist">

</div>
<div style=" padding-top:12px;display:none;" id="refmore">
<a href="http://www.360doc.cn/refmore.aspx?artid=419539379" class="p_newsmore" onclick="wzhit('wapart34')">查看更多馆友评论 &gt;&gt;</a></div>
<div class="w1" style="padding-top: 16px; display: none; " id="inputrefcontent">
<div class="plfbbox">
  <textarea name="textarea" cols="" rows="" class="pltxtbox" id="refcontent" onfocus="if(this.value=='发表评论') this.value='';this.style.color='#1f1f1f'" onblur="if(!this.value) {this.value='发表评论';this.style.color='#8c8c8c';}">发表评论</textarea></div>
</div>

<div style="margin-right: 11px; margin-top: 10px; height: 60px; display: none; " id="refbutton">
<a href="javascript:void(0)"><div class="xianhuabt fr" onclick="wzhit('wapart37');sendref()">发表评论</div></a></div>
<div style=" padding-top:12px;" id="loginref">
<div class="p_newsmore4 lan" style=" height:68px; line-height:68px;">您好，请&nbsp;<a href="http://www.360doc.cn/login.aspx?url=8215213_419539379.html" id="articlelogin" onclick="wzhit('wapart35')">登录</a>&nbsp;或者&nbsp;<a href="http://www.360doc.cn/register.aspx" onclick="wzhit('wapart36')">注册</a>&nbsp;后再进行评论</div></div>
<div class="fenxiagn w1" style=" height:99px; padding-right:22px; font-size:14px;text-align:center;padding-top:15px;" id="loginref2">合作登录：<a href="http://www.360doc.com/redirect2oplogin.aspx?t=wapsmb&amp;reurl=http://www.360doc.cn/myindex.aspx" style="margin-right:20px;" onclick="wzhit('wapart38')"><img src="tb15.png.avi"></a><a href="http://www.360doc.com/redirect2oplogin.aspx?t=wapqq&amp;reurl=http://www.360doc.cn/myindex.aspx" style="margin-right:20px;" onclick="wzhit('wapart39')"><img src="tb16.png.avi"></a><a href="http://www.360doc.com/redirect2oplogin.aspx?t=rr&amp;reurl=http://www.360doc.cn/myindex.aspx?waprr=1" onclick="wzhit('wapart40')"><img src="tb17.png"></a></div>

</section>
<div id="tipiphonediv" style="">

    

    <div style="" id="_8v9aygtur700ms4i"></div>


    
   
   
</div>



        

        <nav>
        <div style="height:20px;"></div>
<ul class="p_nav p_nav_footer">
				<li style=" width:18%"><a href="http://www.360doc.cn/index.aspx" onclick="wzhit(56)">首页</a>
				</li><li style=" width:30%"><a href="http://www.360doc.cn/advice.aspx?type=0" onclick="wzhit(58)">留言交流</a>
				</li><li style=" width:30%"><a href="http://www.360doc.cn/lianxiwomen.aspx" onclick="wzhit(57)">联系我们</a>
				</li><li style=" width:22%"><a href="javascript:scroll(0,0)" onclick="wzhit(59)">回顶部</a>
				</li></ul>
</nav>
        <footer data-sudaclick="footer">
		<div class="p_footer">
			<p class="p_foot_v">
				<a href="http://www.360doc.cn/3g/index.aspx" onclick="wzhit(60)">3G版</a>|
				<a href="http://www.360doc.cn/index.aspx" class="active" onclick="wzhit(61)">触屏版</a>|
                <a href="http://www.360doc.com/mobile" onclick="wzhit(62)">电脑版</a>|
                <a href="http://www.360doc.cn/kehuduan.aspx" onclick="wzhit(63)">客户端</a>
			</p>
			<p class="p_foot_t">©360doc( 京ICP证090625号)</p>
		</div>
	</footer>
    


   




</body></html>
