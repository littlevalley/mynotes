<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=gbk">
<base href="http://www.cnblogs.com/ITtangtang/p/3951240.html">
<style>
body{position:relative}
body,form{margin:0!important;padding:0!important}
#bd_snap{font:13px arial;color:#000;background:#fff;text-align:left;padding:13px 0 0 20px}
#bd_snap_txt{clear:both;padding:10px 0 2px;line-height:24px;color:#333}
#bd_snap_note{color:#999;padding-bottom:10px}
#bd_snap a{font:13px arial;color:#00c;text-decoration:underline}
#bd_snap_note a{color:#999}
#bd_snap_head{width:860px;height:44px}
#bd_snap_logo{width:162px;height:38px;display:block;background:url(logo-snap.png) no-repeat;margin-right:15px;float:left}
#bd_snap_search{width:680px;position:absolute;left:209px;top:17px}
#bd_snap_kw{width:531px;margin-right: 0;height:24px;padding:4px 7px;padding:6px 7px 2px\9;font:16px arial;vertical-align:top;border: 1px solid #b6b6b6;border-color: #7b7b7b #b6b6b6 #b6b6b6 #7b7b7b;background: #fff;display:inline-block;border-right-width: 0;border-color: #b8b8b8 transparent #ccc #b8b8b8;overflow: hidden;outline:0}
#bd_snap_kw:hover{border-color: #999 transparent #b3b3b3 #999;}
#bd_snap_kw:focus{border-color: #4791ff transparent #4791ff #4791ff}
#bd_snap_su{width:100px;height:34px;font-size:14px;color:#fff;padding:0;letter-spacing: 1px;background: #3385ff; border-bottom: 1px solid #2d78f4;outline: medium;-webkit-appearance: none;-webkit-border-radius: 0;cursor:pointer;border:0}
#bd_snap_search input.bd_snap_btn_h{background: #3075dc;box-shadow: inset 1px 1px 3px #2964bb;-webkit-box-shadow: inset 1px 1px 3px #2964bb;-moz-box-shadow: inset 1px 1px 3px #2964bb;-o-box-shadow: inset 1px 1px 3px #2964bb;}
#bd_snap_search input.btnhover{background: #317ef3;border-bottom: 1px solid #2868c8;box-shadow: 1px 1px 1px #ccc;}
#bd_snap_btn_wr{width:97px;height:34px;display:inline-block;_top:1px;*position:relative}
#bd_snap_ln{height:1px;border-top:1px solid #ACA899;background:#ECE9D8;overflow:hidden}
#bd_snap_txt span a{text-decoration:none}
</style>


</head><body><div id="bd_snap">
    <div id="bd_snap_head">
        <a href="http://www.baidu.com/" id="bd_snap_logo" title="到百度首页"></a>
    </div>
    <div id="bd_snap_txt">您查询的关键词是：<span><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448.htm#baidusnap0" style="color:black;background-color:#ffff66;padding:0 3px;font-weight:bold">convert</a><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448.htm#baidusnap1" style="color:black;background-color:#A0FFFF;padding:0 3px;font-weight:bold">gravity</a></span>  <span style="margin-left:5px">以下是该网页在北京时间 2016年05月07日 04:57:57 的快照；</span>
        <p>如果打开速度慢，可以尝试<a href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448e435061e5a1d85fd747e45428099297a43b24857edf33674351420c0c18ed714c9fecf68798776692c58d10154c419de9e0676857bd611&amp;p=882a9546dc8c12a05afbc23846479c&amp;newp=882a9546dc9233fc57efc5604b4bc4231610db2151d4d5116b82c825d7331b001c3bbfb423221a07d7ce776c05a94d5fedf43175310327a3dda5c91d9fb4c57479d955&amp;user=baidu&amp;fm=sc&amp;query=convert+gravity&amp;qid=e927a50f00069d37&amp;p1=2&amp;fast=y">快速版</a>；如果想更新或删除快照，可以<a href="http://tousu.baidu.com/webmaster/add?link=http%3A%2F%2Fcache.baiducontent.com%2Fc%3Fm%3D9f65cb4a8c8507ed4fece763105392230e54f73260878e482a958448e435061e5a1d85fd747e45428099297a43b24857edf33674351420c0c18ed714c9fecf68798776692c58d10154c419de9e0676857bd611%26p%3D882a9546dc8c12a05afbc23846479c%26newp%3D882a9546dc9233fc57efc5604b4bc4231610db2151d4d5116b82c825d7331b001c3bbfb423221a07d7ce776c05a94d5fedf43175310327a3dda5c91d9fb4c57479d955%26user%3Dbaidu%26fm%3Dsc%26query%3Dconvert%2Bgravity%26qid%3De927a50f00069d37%26p1%3D2" id="bd_tousu">投诉快照</a>。
        </p>
    </div>
<script>document.getElementById("bd_tousu").href = "http://tousu.baidu.com/webmaster/add?link=" + encodeURIComponent(document.location);</script>
    <div id="bd_snap_note">百度和网页 <a href="http://www.cnblogs.com/ITtangtang/p/3951240.html">http://www.cnblogs.com/ITtangtang/p/3951240.html</a> 的作者无关，不对其内容负责。百度快照谨为网络故障时之索引，不代表被搜索网站的即时页面。</div>
</div>
<div id="bd_snap_search">
	<form action="http://www.baidu.com/s"><input name="cl" type="hidden" value="3"><input id="bd_snap_kw" maxlength="100" name="wd" value=""><span id="bd_snap_btn_wr"><input class="bd_snap_btn" id="bd_snap_su" onmousedown="this.className=&#x27;bd_snap_btn btnhover&#x27;" onmouseout="this.className=&#x27;bd_snap_btn&#x27;" onmouseover="this.className=&#x27;bd_snap_btn bd_snap_btn_h&#x27;" onmouseup="this.className=&#x27;bd_snap_btn&#x27;" type="submit" value="百度一下"></span></form>
</div>
<div id="bd_snap_ln"></div>
<div style="position:relative">



<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ImageMagick常用指令详解 - 牛奶、不加糖 - 博客园</title>
<link href="blog-common.css_v_8F6.css" rel="stylesheet" type="text/css">
<link href="bundle-coffee.css_v_H7P.css" id="MainCss" rel="stylesheet" type="text/css">
<link href="115420.css_v_AiV.css" rel="stylesheet" type="text/css">
<link href="http://www.cnblogs.com/ITtangtang/rss" rel="alternate" title="RSS" type="application/rss+xml">
<link href="http://www.cnblogs.com/ITtangtang/rsd.xml" rel="EditURI" title="RSD" type="application/rsd+xml">
<link href="http://www.cnblogs.com/ITtangtang/wlwmanifest.xml" rel="wlwmanifest" type="application/wlwmanifest+xml">
  




<a name="top"></a>

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a href="http://www.cnblogs.com/ITtangtang/" id="lnkBlogLogo"><img alt="返回主页" id="blogLogo" src="logo.gif"></a>			
		
<!--done-->
<h1><a class="headermaintitle" href="http://www.cnblogs.com/ITtangtang/" id="Header1_HeaderTitle">哼哼哈嘿</a></h1>
<h2>每天多一篇博客，生活多一份收获！</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="navigator">
			
<ul id="navList">
	<li><a class="menu" href="http://www.cnblogs.com/" id="MyLinks1_HomeLink">博客园</a></li>
	<li><a class="menu" href="http://www.cnblogs.com/ITtangtang/" id="MyLinks1_MyHomeLink">首页</a></li>
	<li><a class="menu" href="http://i.cnblogs.com/EditPosts.aspx?opt=1" id="MyLinks1_NewPostLink" rel="nofollow">新随笔</a></li>
	<li><a accesskey="9" class="menu" href="http://msg.cnblogs.com/send/%E7%89%9B%E5%A5%B6%E3%80%81%E4%B8%8D%E5%8A%A0%E7%B3%96" id="MyLinks1_ContactLink" rel="nofollow">联系</a></li>
	<li><a class="menu" href="http://i.cnblogs.com/" id="MyLinks1_Admin" rel="nofollow">管理</a></li>
	<li>
	</li>
</ul>


			<div class="blogStats">
				
				
<!--done-->
随笔- 77&#xa0;
文章- 0&#xa0;
评论- 73&#xa0;

				
			</div><!--end: blogStats -->
		</div><!--end: navigator 博客导航栏 -->
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a class="postTitle2" href="http://www.cnblogs.com/ITtangtang/p/3951240.html" id="cb_post_title_url">ImageMagick常用指令详解</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">Imagemagick常用指令</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">(<a href="http://blog.csdn.net/lan861698789/article/details/7738383">ImageMagick</a>--蓝天白云)</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">(<a href="http://www.imagemagick.org/script/command-line-tools.php" target="_blank">ImageMagick官网</a>)</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">(<a href="http://bbs.konotes.org/thread-5180-1-1.html" target="_blank">其他比较有价值的IM参考</a>)</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier;">(</span><a href="http://outofmemory.cn/wr/?u=http%3A%2F%2Fwww.imququ.com%2Fpost%2Fhow-to-auto-rotate-photo-in-js.html" target="_blank"><span style="font-family: &#x27;courier new&#x27;, courier; color: #0000ff;">图片自动旋转的前端实现方案</span></a><span style="font-family: &#x27;courier new&#x27;, courier;">)</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><a name="baidusnap0"></a><b style="color:black;background-color:#ffff66">convert</b> 转换图像格式和大小，模糊，裁剪，驱除污点，抖动，临近，图片上画图片，加入新图片，生成缩略图等。</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">identify 描述一个或较多图像文件的格式和特性。</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">composite 根据一个图片或多个图片组合生成图片</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">举个例子</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; [src]{file}.{ext} -quality 80&#xa0;-resize &#x27;280x140^&gt;&#x27; -<a name="baidusnap1"></a><b style="color:black;background-color:#A0FFFF">gravity</b> Center -crop 280x140+0+0 +repage [out]{file}_280x140.{ext}</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">把一张图片按80的质量去压缩(jpg的压缩参数),同时按图片比例非强制缩放成不超过280x140的图片.居中裁剪280x140,去掉图片裁减后的空白和图片exif信息,通常这种指令是为了保证图片大小正好为280x140</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">下面对各个指令的含义简要说明</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">-quality &#xa0;&#xa0;图片质量,jpg默认99,png默认75</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">-resize</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100 &#xa0; &#xa0; &#xa0;高度和宽度比例保留最高值，高比不变</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100^ &#xa0; &#xa0; 高度和宽度比例保留最低值，宽高比不变</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100! &#xa0; &#xa0; &#xa0;宽度和高度强制转换，忽视宽高比</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100&gt; &#xa0; &#xa0; 更改长宽，当图片长或宽超过规定的尺寸</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100&lt; &#xa0; &#xa0; 更改长宽&#xa0;只有当图片长宽都超过规定的尺寸</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100^&gt; &#xa0;&#xa0;更改长宽，当图片长或宽超过规定的尺寸。高度和宽度比例保留最低值</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100x100^&lt; &#xa0;&#xa0;更改长宽，只有当图片长宽都超过规定的尺寸。高度和宽度比例保留最低值</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">100&#xa0; &#xa0; &#xa0; &#xa0; &#xa0; &#xa0; &#xa0;<span class="Apple-tab-span">按指定的宽度缩放，保持宽高比例</span></span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;x100&#xa0; &#xa0; &#xa0; &#xa0; &#xa0;&#xa0;<span class="Apple-tab-span">按指定高度缩放，保持宽高比</span></span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">-<b style="color:black;background-color:#A0FFFF">gravity</b> NorthWest,&#xa0;North,&#xa0;NorthEast,&#xa0;West,&#xa0;Center,&#xa0;East,&#xa0; SouthWest,&#xa0;South,&#xa0;SouthEast截取用的定位指令,定位截取区域在图片中的方位</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">-crop 200x200+0+0&#xa0;截取用的截取指令&#xa0;,在用定位指令后,按后两位的偏移值偏移截取范围左上角的像素后,再按前两位的数值,从左上角开始截取相应大小的图片</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">+repage 去掉图片裁减后的空白</span></p>
<p><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">-dissolve	30 设定组合图片透明度dissolve示例</span></p>
<p><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">+/-profile *	 去掉/添加图片exif信息</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">下面记录下一些比较复杂一点的指令:</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; [src]{file}.{ext} -quality 90 -resize &#x27;700&gt;&#x27; /data/tony/watermark_1.png -<b style="color:black;background-color:#A0FFFF">gravity</b> southeast -compose Dissolve -composite [out]{file}_1024x1024.{ext}</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; [src]{file}.{ext} /data/watermark_1.png -<b style="color:black;background-color:#A0FFFF">gravity</b> southeast -geometry +10+10 -composite [src]{file}.{ext}</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; [src]{file}.{ext} -coalesce -resize &#x27;950x135&gt;&#x27; [out]{file}_950x135.{ext}</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; [src]{file}.{ext} -resize &#x27;650x500&gt;&#x27; miff:- | composite +profile &#x27;*&#x27; -dissolve 30 -<b style="color:black;background-color:#A0FFFF">gravity</b> southeast /data/tony/watermark_1.png - [out]{file}_650x500.{ext}</span></p>
<p class="p0"><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> [src]{file}.{ext} -quality 80 -resize &#x27;190&gt;&#x27; -background white -<b style="color:black;background-color:#A0FFFF">gravity</b> center -extent 190x +repage [out]{file}_width190.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">【/bin/sh^M: bad interpreter: 没有那个文件或目录】</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">vim filename&#xa0;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">然后用命令&#xa0;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">:set ff? #可以看到dos或unix的字样. 如果的确是dos格式的。&#xa0;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">然后用&#xa0;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">:set ff=unix #把它强制为unix格式的, 然后存盘退出。</span></p>
<p><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">###############################################</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">shell 除法计算</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">shell计算中使用除法，基本默认上都是整除。</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">比如：</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">num1=2</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">num2=3</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">num3=`expr $num1 / $num2`</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">这个时候num3=0 ,是因为是因为expr不支持浮点除法</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">解决的方法：</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">num3=`echo &quot;scale=2; $num1/$num2&quot; | bc`</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用bc工具，sclae控制小数点后保留几位</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">还有一种方法</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">awk &#x27;BEGIN{printf &quot;%.2f\n&quot;,’$num1‘/’$num2‘}&#x27;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">如果用百分比表示</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">awk &#x27;BEGIN{printf &quot;%.2f%\n&quot;,(’$num1‘/’$num2‘)*100}&#x27;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">##############################################</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; -size 950x135 xc:#ffffff [src]{file}.{ext} -resize 950x135 -<b style="color:black;background-color:#A0FFFF">gravity</b> center -compose Src-over -composite [out]{file}_950x135.{ext}</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">解读：该指令会把gif的动态图拆分成好几张图，</span></p>
<p><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">-coalesce</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">完全定义一个GIF动画序列的每一帧的外观，形成“电影胶片”动画</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">根据它的-处置元数据覆盖各图像中的图像序列，以再现一个动画中的动画序列中的每个点的外观。有的图片应该是相同的大小，并且为动画继续如预期般GIF动画的工作分配适当的GIF处理设置。这样的帧更容易查看和比高度优化的GIF图像叠加处理。</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">该动画可以重新优化使用层法“优化”处理后，虽然没有保证恢复的GIF动画优化是比原来更好。</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">##################################################</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">gif拿到的只是最后一帧的数据,所以gif的图片在width和height值上有出入</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; tly2.gif -resize &quot;600&gt;&quot; tly2_600.gif</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">C:\&gt;identify tly2.gif</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[0] GIF 341x186 341x186+0+0 8-bit sRGB 256c 191KB 0.000u 0:00.003</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[1] GIF 194x173 341x186+128+13 8-bit sRGB 256c 191KB 0.000u 0:00.010</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[2] GIF 192x175 341x186+130+11 8-bit sRGB 256c 191KB 0.000u 0:00.013</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[3] GIF 80x177 341x186+131+9 8-bit sRGB 256c 191KB 0.000u 0:00.016</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">...</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[30] GIF 164x175 341x186+122+11 8-bit sRGB 256c 191KB 0.000u 0:00.094</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[31] GIF 145x172 341x186+122+14 8-bit sRGB 256c 191KB 0.000u 0:00.097</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[32] GIF 195x167 341x186+122+19 8-bit sRGB 256c 191KB 0.000u 0:00.100</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">tly2.gif[33] GIF 196x174 341x186+121+12 8-bit sRGB 256c 191KB 0.000u 0:00.105</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">一、crop_center.sh</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>如果原图宽&gt;高:按宽*size/高缩放; 如果原图宽&lt;高:按高*size/宽缩放; 并居中裁剪size*size</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">#!/bin/bash

export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

filename=$1
filename2=$2
size=$3
resize=&quot;70&quot;

wh=($(/usr/local/bin/identify -format &quot;%w %h &quot; $1))

if [ ${wh[0]} -gt ${wh[1]} ]
then
resize=$(echo &quot;${wh[0]}*$size/${wh[1]}+1&quot; | bc)
else
resize=$(echo &quot;${wh[1]}*$size/${wh[0]}+1&quot; | bc)
fi

/usr/local/bin/<b style="color:black;background-color:#ffff66">convert</b> +profile &quot;*&quot; -quality 75 -resize ${resize}x${resize} $filename $filename2

/usr/local/bin/<b style="color:black;background-color:#ffff66">convert</b> +profile &quot;*&quot; -<b style="color:black;background-color:#A0FFFF">gravity</b> Center -crop ${size}x${size}+0+0 $filename2 $filename2</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例：/usr/local/bin/crop_center.sh [src]{file}.{ext} [out]{file}_small.{ext} 100</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">二、tony-<b style="color:black;background-color:#ffff66">convert</b>-1.sh</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>原图按1024x1024&gt;等比缩放，并打水印于右下角；如果宽高都小于300，则直接使用原图</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">#!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 2 ] ; then 
  echo &quot;Usage: tony-<b style="color:black;background-color:#ffff66">convert</b>-1.sh [source path] [dest path]&quot;
  echo &quot;Example: ./tony-<b style="color:black;background-color:#ffff66">convert</b>-1.sh src/1234.jpg out/1234_100x200.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$2&quot;

index1=`expr index &quot;${srcFile}&quot; /`
index2=`expr index &quot;${srcFile}&quot; .`
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``

#identify image num
picCount=`/usr/local/sbin/bin/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/sbin/bin/bin/identify -format &quot;%wx%h %f\n&quot; ${srcFile}`

index1=`expr index &quot;${sizeMatrix}&quot; x`
width=`expr substr &quot;${sizeMatrix}&quot; 1 \`expr ${index1} - 1\``
echo width: ${width}
index2=`expr \`expr index &quot;${sizeMatrix}&quot; &#x27; &#x27;\` - ${index1} - 1`
height=`expr substr &quot;${sizeMatrix}&quot; \`expr ${index1} + 1\` ${index2}`
echo height: ${height}

if [ ${width} -lt 300 ] ; then
  if [ ${height} -lt 300 ] ; then
    echo Image size less than 300x300
    cp ${srcFile} ${dstFile}
    exit 0
  fi
fi

if [ `echo ${ext}|tr &#x27;a-z&#x27; &#x27;A-Z&#x27;` = &quot;BMP&quot; ] ; then
  index1=`expr index &quot;${dstFile}&quot; .`
  dstFile=`expr substr &quot;${dstFile}&quot; 1 \`expr ${index1} - 1\``.jpg 
fi

#<b style="color:black;background-color:#ffff66">convert</b> image/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; ${srcFile} -resize &#x27;1024x1024&gt;&#x27; /data/tony/watermark_1.png -<b style="color:black;background-color:#A0FFFF">gravity</b> southeast -compose Dissolve -composite  ${dstFile}</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例:/usr/local/sbin/bin/bin/tony-<b style="color:black;background-color:#ffff66">convert</b>-1.sh [src]{file}.{ext} [out]{file}_1024x1024.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">三、resizeByWidthOrHeight.sh:</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>宽大于高时：定宽等比缩放 高自适应；宽小于高时：定高等比缩放,宽自适应</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">#!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 3 ] ; then 
  echo &quot;Usage: resizeByWidthOrHeight.sh [source path] [widthxheigth] [dest path]&quot;
  echo &quot;Example: ./resizeByWidthOrHeight.sh src/1234.jpg 150x150 out/1234_150x2150.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$3&quot;

destSize=&quot;$2&quot;
destWidth=${destSize%x*}
destHeight=${destSize#*x}
echo &quot;destSize: ${destWidth}x${destHeight}&quot;

index1=`expr index &quot;${srcFile}&quot; /`
echo &quot;index1: $index1&quot;
index2=`expr index &quot;${srcFile}&quot; .`
echo &quot;index2: $index2&quot;
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
echo &quot;file: $file&quot;
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``
echo &quot;ext: $ext&quot;
#identify image num
picCount=`/usr/local/sbin/bin/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/sbin/bin/bin/identify -format &quot;%wx%h&quot; ${srcFile}`

echo &quot;index1: $index1&quot;
width=${sizeMatrix%x*}
echo width: ${width}
height=${sizeMatrix#*x}
echo height: ${height}

newSize=&quot;${destWidth}x${destHeight}&quot;
# width &lt; height
if [ ${width} -lt ${height} ] ; then
  newSize=&quot;&#x27;x${destHeight}&gt;&#x27;&quot;
else
  newSize=&quot;&#x27;${destWidth}&gt;&#x27;&quot;
fi
echo &quot;newSize: ${newSize}&quot;

# resize
resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${srcFile} -quality 100 -resize ${newSize} ${dstFile}&quot;
echo &quot;resizeCmd: ${resizeCmd}&quot;
eval &quot;${resizeCmd}&quot;</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例：/usr/local/sbin/bin/bin/resizeByWidthOrHeight.sh [src]{file}.{ext} 594x395 [out]{file}_594x395.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">四、tony-<b style="color:black;background-color:#ffff66">convert</b>-2.sh:</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>缩放规则：</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>目标图宽&lt;高时:定高等比压缩，宽自适应;</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>原图宽高比&gt;目标图宽高比时:定高等比压缩，宽自适应;</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>否则：定宽等比压缩，高自适应</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>裁剪规则：默认居中，若目标图宽&gt;=高，则居左上角</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">#!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 3 ] ; then 
  echo &quot;Usage: tony-<b style="color:black;background-color:#ffff66">convert</b>-2.sh [source path] [widthxheigth] [dest path]&quot;
  echo &quot;Example: ./tony-<b style="color:black;background-color:#ffff66">convert</b>-2.sh src/1234.jpg 150x150 out/1234_150x150.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$3&quot;

destSize=&quot;$2&quot;
destWidth=${destSize%x*}
destHeight=${destSize#*x}
echo &quot;destSize: ${destWidth}x${destHeight}&quot;

index1=`expr index &quot;${srcFile}&quot; /`
echo &quot;index1: $index1&quot;
index2=`expr index &quot;${srcFile}&quot; .`
echo &quot;index2: $index2&quot;
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
echo &quot;file: $file&quot;
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``
echo &quot;ext: $ext&quot;
#identify image num
picCount=`/usr/local/sbin/bin/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/sbin/bin/bin/identify -format &quot;%wx%h&quot; ${srcFile}`

echo &quot;index1: $index1&quot;
width=${sizeMatrix%x*}
echo width: ${width}
height=${sizeMatrix#*x}
echo height: ${height}

if [ `echo ${ext}|tr &#x27;a-z&#x27; &#x27;A-Z&#x27;` = &quot;BMP&quot; ] ; then
  index1=`expr index &quot;${dstFile}&quot; .`
  dstFile=`expr substr &quot;${dstFile}&quot; 1 \`expr ${index1} - 1\``.jpg 
fi

srcRate=$(echo &quot;scale=9; $width*1.0 / $height*1.0&quot; | bc)
destRate=$(echo &quot;scale=9; $destWidth*1.0 / $destHeight*1.0&quot; | bc)

echo &quot;srcRate: ${srcRate}&quot;
echo &quot;destRate: ${destRate}&quot;

resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; ${srcFile} -resize &#x27;${destWidth}x${destHeight}^&gt;&#x27; -<b style="color:black;background-color:#A0FFFF">grAvity</b> Center -crop ${destWidth}x${destHeight}+0+0 +repage ${dstFile}&quot;
newSize=&quot;${destWidth}x${destHeight}&quot;
# width &lt; height
if [ ${destWidth} -lt ${destHeight} ] ; then
  newSize=&quot;x${destHeight}&gt;&quot;
elif [ `echo &quot;${srcRate} &gt; ${destRate}&quot; | bc` -eq 1 ] ; then
  newSize=&quot;x${destHeight}&gt;&quot;
else
  newSize=&quot;${destWidth}&gt;&quot;
fi

grAvityWay=&quot;Center&quot;
# width &lt; height
if [ ${destWidth} -ge ${destHeight} ] ; then
  grAvityWay=&quot;NorthWest&quot;
fi

# resize
resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> +profile &#x27;*&#x27; ${srcFile} -resize &#x27;${newSize}&#x27; -<b style="color:black;background-color:#A0FFFF">grAvity</b> ${grAvityWay} -crop ${destWidth}x${destHeight}+0+0 +repage ${dstFile}&quot;
echo &quot;resizeCmd: ${resizeCmd}&quot;
eval &quot;${resizeCmd}&quot;</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例:/usr/local/sbin/bin/bin/tony-<b style="color:black;background-color:#ffff66">convert</b>-2.sh [src]{file}.{ext} 170x105 [out]{file}_170x105.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">五、tony-<b style="color:black;background-color:#ffff66">convert</b>-3.sh:&#xa0;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>以destWidth表示目的图宽，destHeight表示目的图高，persentSize=destWidth/destHeight表示目的图宽高比;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&lt;destWidth且高&lt;destHeight时，不截取，直接上传;&#xa0;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&lt;destWidth,高&gt;destHeight时，以原图宽为宽居中裁剪 竖图;&#xa0;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&gt;destWidth,高&lt;destHeight时，以原图高为高居中裁剪 横图;&#xa0;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&gt;destWidth,高&gt;destHeight,&#xa0;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>{</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽/高&gt;persentSize时，将原图高压缩为destHeight居中裁剪&#xa0;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽/高&lt;persentSize时，将原图宽压缩为destWidth居中裁剪</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>}</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 3 ] ; then 
  echo &quot;Usage: tony-<b style="color:black;background-color:#ffff66">convert</b>-3.sh [source path] [widthxheigth] [dest path]&quot;
  echo &quot;Example: ./tony-<b style="color:black;background-color:#ffff66">convert</b>-3.sh src/1234.jpg 750x375 out/1234_750x375.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$3&quot;

destSize=&quot;$2&quot;
destWidth=${destSize%x*}
destHeight=${destSize#*x}
echo &quot;destSize: ${destWidth}x${destHeight}&quot;

index1=`expr index &quot;${srcFile}&quot; /`
echo &quot;index1: $index1&quot;
index2=`expr index &quot;${srcFile}&quot; .`
echo &quot;index2: $index2&quot;
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
echo &quot;file: $file&quot;
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``
echo &quot;ext: $ext&quot;

#identify image num
picCount=`/usr/local/sbin/bin/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/sbin/bin/bin/identify -format &quot;%wx%h&quot; ${srcFile}`

echo &quot;index1: $index1&quot;
width=${sizeMatrix%x*}
echo width: ${width}
height=${sizeMatrix#*x}
echo height: ${height}

#if [ `echo ${ext}|tr &#x27;a-z&#x27; &#x27;A-Z&#x27;` = &quot;BMP&quot; ] ; then
  #index1=`expr index &quot;${dstFile}&quot; .`
  #dstFile=`expr substr &quot;${dstFile}&quot; 1 \`expr ${index1} - 1\``.jpg 
#fi


#newSize=&quot;${destWidth}x${destHeight}&quot;
heightPadding=&quot;0&quot;
widthPadding=&quot;0&quot;
persentSize=`echo &quot;scale=4; ${destWidth}/${destHeight}&quot; | bc`
echo &quot;persentSize: ${persentSize}&quot;

# quality
qualityCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${srcFile} -quality 90 ${dstFile}&quot;
echo &quot;qualityCmd: ${qualityCmd}&quot;
eval &quot;${qualityCmd}&quot;


# width &gt; 750 &amp;&amp; height &lt;375  hengTu
if [ ${width} -gt ${destWidth} ] &amp;&amp; [ ${height} -lt ${destHeight} ] ; then
  heightPadding=$[ ${destHeight}/2-${height}/2]
  echo heightPadding: ${heightPadding}
  flag=0
# width &lt; 750 &amp;&amp; height &gt;375  shuTu
elif [ ${width} -lt ${destWidth} ] &amp;&amp; [ ${height} -gt ${destHeight} ] ; then
  widthPadding=$[ ${destWidth}/2-${width}/2 ]
  echo widthPadding: ${widthPadding}
  flag=0
# width &gt; 750 &amp;&amp; height &gt;375  resize and crop
elif [ ${width} -gt ${destWidth} ] &amp;&amp; [ ${height} -gt ${destHeight} ] &amp;&amp; [ $ [ ${width}/${height} ]&gt;${persentSize} ]  ; then
  echo &quot;resize by src&#x27;s height then crop&quot;
  newSize=&quot;&#x27;x${destHeight}&gt;&#x27;&quot;
  flag=1
elif [ ${width} -gt ${destWidth} ] &amp;&amp; [ ${height} -gt ${destHeight} ] &amp;&amp; [ $[ ${width}/${height} ]&lt;${persentSize} ]  ; then
  echo &quot;resize by src&#x27;s width then crop&quot;
  newSize=&quot;&#x27;${destWidth}&gt;&#x27;&quot;
  flag=1
fi
  
echo &quot;newSize: ${newSize}&quot;

# resize
if [ ${flag} -eq 1 ] ; then
  resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -resize ${newSize} ${dstFile}&quot;
  echo &quot;resizeCmd: ${resizeCmd}&quot;
  eval &quot;${resizeCmd}&quot;

  cropCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -<b style="color:black;background-color:#A0FFFF">gravity</b> Center  -crop ${destSize}+0+0 +repage ${dstFile}&quot;
else
  echo &quot;only crop pic&quot;
  cropCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -<b style="color:black;background-color:#A0FFFF">gravity</b> Center  -crop ${destSize}+${widthPadding}+${heightPadding} +repage ${dstFile}&quot;
fi

# crop
echo &quot;cropCmd: ${cropCmd}&quot;
eval &quot;${cropCmd}&quot;</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例：/usr/local/sbin/bin/bin/tony-<b style="color:black;background-color:#ffff66">convert</b>-3.sh [src]{file}.{ext} 750x375 [out]{file}_750x375.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">六、tony-<b style="color:black;background-color:#ffff66">convert</b>-3_bg.sh:&#xa0;</span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>以destWidth表示目的图宽，destHeight表示目的图高，</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&lt;destWidth且高&lt;destHeight时，不截取，直接上传;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&lt;destWidth,高&gt;destHeight时，以原图宽为宽居中裁剪 树图;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&gt;destWidth,高&lt;destHeight时，以原图高为高居中裁剪 横图;</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&gt;destWidth,高&gt;destHeight,</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>{</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&gt;高时，将原图高压缩为destHeight居中裁剪</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>当原图宽&lt;高时，将原图宽压缩为destWidth居中裁剪</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>}</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>所有情况都要居中补白</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 3 ] ; then 
  echo &quot;Usage: tony-<b style="color:black;background-color:#ffff66">convert</b>-3_bg.sh [source path] [widthxheigth] [dest path]&quot;
  echo &quot;Example: ./tony-<b style="color:black;background-color:#ffff66">convert</b>-3_bg.sh src/1234.jpg 750x375 out/1234_750x375.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$3&quot;

destSize=&quot;$2&quot;
destWidth=${destSize%x*}
destHeight=${destSize#*x}
echo &quot;destSize: ${destWidth}x${destHeight}&quot;

index1=`expr index &quot;${srcFile}&quot; /`
echo &quot;index1: $index1&quot;
index2=`expr index &quot;${srcFile}&quot; .`
echo &quot;index2: $index2&quot;
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
echo &quot;file: $file&quot;
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``
echo &quot;ext: $ext&quot;

#identify image num
picCount=`/usr/local/sbin/bin/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/sbin/bin/bin/identify -format &quot;%wx%h&quot; ${srcFile}`

echo &quot;index1: $index1&quot;
width=${sizeMatrix%x*}
echo width: ${width}
height=${sizeMatrix#*x}
echo height: ${height}

# quality
qualityCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${srcFile} -quality 90 ${dstFile}&quot;
echo &quot;qualityCmd: ${qualityCmd}&quot;
eval &quot;${qualityCmd}&quot;


# width &gt; 750 &amp;&amp; height &lt;375  hengTu
flag=0
if [ ${width} -gt ${destWidth} ] &amp;&amp; [ ${height} -lt ${destHeight} ] ; then
  heightPadding=$[ ${destHeight}/2-${height}/2]
  echo heightPadding: ${heightPadding}
  flag=0
# width &lt; 750 &amp;&amp; height &gt;375  shuTu
elif [ ${width} -lt ${destWidth} ] &amp;&amp; [ ${height} -gt ${destHeight} ] ; then
  widthPadding=$[ ${destWidth}/2-${width}/2 ]
  echo widthPadding: ${widthPadding}
  flag=0
# width &gt; 750 &amp;&amp; height &gt;375  resize and crop
elif [ ${width} -gt ${destWidth} ] &amp;&amp; [ ${height} -gt ${destHeight} ] &amp;&amp; [ ${width} -gt ${height} ]  ; then
  echo &quot;resize by src&#x27;s height then crop&quot;
  newSize=&quot;&#x27;x${destHeight}&gt;&#x27;&quot;
  flag=1
elif [ ${width} -gt ${destWidth} ] &amp;&amp; [ ${height} -gt ${destHeight} ] &amp;&amp; [ ${width} -lt ${height} ]  ; then
  echo &quot;resize by src&#x27;s width then crop&quot;
  newSize=&quot;&#x27;${destWidth}&gt;&#x27;&quot;
  flag=1
fi
  
echo &quot;newSize: ${newSize}&quot;

# resize
if [ ${flag} -eq 1 ] ; then
  resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -resize ${newSize} ${dstFile}&quot;
  echo &quot;resizeCmd: ${resizeCmd}&quot;
  eval &quot;${resizeCmd}&quot;
  cropCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -<b style="color:black;background-color:#A0FFFF">gravity</b> Center -crop ${destSize}+0+0 +repage -background white -compose Copy -<b style="color:black;background-color:#A0FFFF">gravity</b> center -extent ${destSize} ${dstFile}&quot;
else
  echo &quot;only crop pic&quot;
  cropCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -<b style="color:black;background-color:#A0FFFF">gravity</b> Center -crop ${destSize}+0+0 +repage -background white -compose Copy -<b style="color:black;background-color:#A0FFFF">gravity</b> center -extent ${destSize} ${dstFile}&quot;
fi

# crop
echo &quot;cropCmd: ${cropCmd}&quot;
eval &quot;${cropCmd}&quot;</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例：【240x240大小，背景补白，1PX灰色边框】&#xa0;/usr/local/sbin/bin/bin/tony-<b style="color:black;background-color:#ffff66">convert</b>-3_bg.sh [src]{file}.{ext} 240x240 [out]{file}_240x240.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">七、tony-<b style="color:black;background-color:#ffff66">convert</b>-4.sh:&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>原图宽大于destWidth:</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>{</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>高&gt;destHeight时：定宽等比缩放 以原图高为高居中裁剪；</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>否则：从左上角裁剪</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>}</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>原图宽小于destWidth:</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>{</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>高&gt;destHeight时：以原图高为高居中裁剪；</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>否则：从左上角裁剪</em></span><br><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em>}</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">#!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 3 ] ; then 
  echo &quot;Usage: tony-<b style="color:black;background-color:#ffff66">convert</b>-4.sh [source path] [widthxheigth] [dest path]&quot;
  echo &quot;Example: ./tony-<b style="color:black;background-color:#ffff66">convert</b>-4.sh src/1234.jpg 150x150 out/1234_150x150.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$3&quot;

destSize=&quot;$2&quot;
destWidth=${destSize%x*}
destHeight=${destSize#*x}
echo &quot;destSize: ${destWidth}x${destHeight}&quot;

index1=`expr index &quot;${srcFile}&quot; /`
echo &quot;index1: $index1&quot;
index2=`expr index &quot;${srcFile}&quot; .`
echo &quot;index2: $index2&quot;
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
echo &quot;file: $file&quot;
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``
echo &quot;ext: $ext&quot;

#identify image num
picCount=`/usr/local/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/bin/identify -format &quot;%wx%h&quot; ${srcFile}`

echo &quot;index1: $index1&quot;
width=${sizeMatrix%x*}
echo width: ${width}
height=${sizeMatrix#*x}
echo height: ${height}

#if [ `echo ${ext}|tr &#x27;a-z&#x27; &#x27;A-Z&#x27;` = &quot;BMP&quot; ] ; then
  #index1=`expr index &quot;${dstFile}&quot; .`
  #dstFile=`expr substr &quot;${dstFile}&quot; 1 \`expr ${index1} - 1\``.jpg 
#fi


newSize=&quot;${destWidth}x${destHeight}&quot;
# width &lt; height
if [ ${width} -gt ${destWidth} ] ; then
  newSize=&quot;&#x27;${destWidth}&gt;&#x27;&quot;
  if [ ${height} -gt ${destHeight}] ; then
  heihgtPadding=&quot;&#x27;${destHeight}/2&#x27;&quot;
  else
  heihgtPadding=&quot;&#x27;0&#x27;&quot;
  fi
else
  newSize=&quot;&#x27;${width}&gt;&#x27;&quot;
  if [ ${height} -gt ${destHeight}] ; then
    heihgtPadding=&quot;&#x27;${destHeight}/2&#x27;&quot;
  else
    heihgtPadding=&quot;&#x27;0&#x27;&quot;
  fi
fi

echo &quot;newSize: ${newSize}&quot;

# resize
resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${srcFile} -quality 90 -resize ${newSize} ${dstFile}&quot;
echo &quot;resizeCmd: ${resizeCmd}&quot;
eval &quot;${resizeCmd}&quot;
# add white ground
addWhiteCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -crop ${destSize}+0-${heihgtPadding} +repage ${dstFile}&quot;
echo &quot;addWhiteCmd: ${addWhiteCmd}&quot;
eval &quot;${addWhiteCmd}&quot;</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例：【160*120裁剪或居中加水印】/usr/local/sbin/bin/bin/tony-<b style="color:black;background-color:#ffff66">convert</b>-4.sh [src]{file}.{ext} 160x120 [out]{file}_160.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">八、tony-<b style="color:black;background-color:#ffff66">convert</b>-5.sh:&#xa0;</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;"><em id="__mceDel">宽大于高时：定宽等比缩放 高自适应；<br>宽小于高时：定高等比缩放,宽自适应;<br>并居中补白</em></span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p>
<div class="cnblogs_code">
<pre><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">#!/bin/sh

# we have 2 arguments: source file name and dest file name
if [ $# -ne 3 ] ; then 
  echo &quot;Usage: tony-<b style="color:black;background-color:#ffff66">convert</b>-5.sh [source path] [widthxheigth] [dest path]&quot;
  echo &quot;Example: ./tony-<b style="color:black;background-color:#ffff66">convert</b>-5.sh src/1234.jpg 150x150 out/1234_150x2150.jpg&quot;
  exit 1 
fi

srcFile=&quot;$1&quot;
dstFile=&quot;$3&quot;

destSize=&quot;$2&quot;
destWidth=${destSize%x*}
destHeight=${destSize#*x}
echo &quot;destSize: ${destWidth}x${destHeight}&quot;

index1=`expr index &quot;${srcFile}&quot; /`
echo &quot;index1: $index1&quot;
index2=`expr index &quot;${srcFile}&quot; .`
echo &quot;index2: $index2&quot;
file=`expr substr &quot;${srcFile}&quot; \`expr ${index1} + 1\` \`expr ${index2} - ${index1} - 1\``
echo &quot;file: $file&quot;
ext=`expr substr &quot;${srcFile}&quot; \`expr ${index2} + 1\` \`expr length &quot;${srcFile}&quot; - ${index2}\``
echo &quot;ext: $ext&quot;
#identify image num
picCount=`/usr/local/bin/identify ${srcFile}|grep -c &quot;${file}.${ext}&quot;`
echo animate pictures: ${picCount}

if [ ${picCount} -gt 1 ] ; then
  echo &quot;No handle for animate pictures&quot;
  cp ${srcFile} ${dstFile} 
  exit 0 
fi

#identify image size
sizeMatrix=`/usr/local/bin/identify -format &quot;%wx%h&quot; ${srcFile}`

echo &quot;index1: $index1&quot;
width=${sizeMatrix%x*}
echo width: ${width}
height=${sizeMatrix#*x}
echo height: ${height}

#if [ ${width} -lt 300 ] ; then
#  if [ ${height} -lt 300 ] ; then
#    echo Image size less than 300x300
#    cp ${srcFile} ${dstFile}
#    exit 0
#  fi
#fi

if [ `echo ${ext}|tr &#x27;a-z&#x27; &#x27;A-Z&#x27;` = &quot;BMP&quot; ] ; then
  index1=`expr index &quot;${dstFile}&quot; .`
  dstFile=`expr substr &quot;${dstFile}&quot; 1 \`expr ${index1} - 1\``.jpg 
fi
newSize=&quot;${destWidth}x${destHeight}&quot;
# width &lt; height
if [ ${width} -lt ${height} ] ; then
  newSize=&quot;&#x27;x${destHeight}&gt;&#x27;&quot;
else
  newSize=&quot;&#x27;${destWidth}&gt;&#x27;&quot;
fi
echo &quot;newSize: ${newSize}&quot;

# resize
resizeCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${srcFile} -quality 80 -resize ${newSize} ${dstFile}&quot;
echo &quot;resizeCmd: ${resizeCmd}&quot;
eval &quot;${resizeCmd}&quot;
# add white ground
addWhiteCmd=&quot;/usr/local/sbin/bin/bin/<b style="color:black;background-color:#ffff66">convert</b> ${dstFile} -background white -<b style="color:black;background-color:#A0FFFF">gravity</b> center -extent ${destSize} -<b style="color:black;background-color:#A0FFFF">gravity</b> Center -crop ${destSize}+0+0 +repage ${dstFile}&quot;
echo &quot;addWhiteCmd: ${addWhiteCmd}&quot;
eval &quot;${addWhiteCmd}&quot;</span></pre>
</div>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">使用范例：【正方形图】/usr/local/sbin/bin/bin/tony-<b style="color:black;background-color:#ffff66">convert</b>-5.sh [src]{file}.{ext} 90x90 [out]{file}_90x90.{ext}</span></p>
<p><span style="font-family: &#x27;courier new&#x27;, courier; font-size: 16px;">&#xa0;</span></p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory"></div>
<div id="EntryTag"></div>
<div id="blog_post_info">
</div>
<div class="clear"></div>
<div id="post_next_prev"></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2014-09-02 13:11</span> <a href="http://www.cnblogs.com/ITtangtang/">牛奶、不加糖</a> 阅读(<span id="post_view_count">...</span>) 评论(<span id="post_comment_count">...</span>)  <a href="http://i.cnblogs.com/EditPosts.aspx?postid=3951240" rel="nofollow">编辑</a> <a href="#" onclick="AddToWz(3951240);return false;">收藏</a></div>
	</div>
	
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div>
<div class="commentform" id="comment_form">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a clientidmode="Static" href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();" runat="server">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<div class="c_ad_block" id="ad_c1"></div>
<div id="under_post_news"></div>
<div class="c_ad_block" id="ad_c2"></div>
<div id="under_post_kb"></div>
<div class="c_ad_block" id="HistoryToday"></div>

</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"></div>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"></div>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright 
