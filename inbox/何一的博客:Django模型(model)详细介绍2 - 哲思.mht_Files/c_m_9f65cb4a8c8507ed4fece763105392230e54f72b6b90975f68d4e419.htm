<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=gbk">
<base href="http://www.zeuux.com/blog/content/2143/">
<style>
body{position:relative}
body,form{margin:0!important;padding:0!important}
#bd_snap{font:13px arial;color:#000;background:#fff;text-align:left;padding:13px 0 0 20px}
#bd_snap_txt{clear:both;padding:10px 0 2px;line-height:24px;color:#333}
#bd_snap_note{color:#999;padding-bottom:10px}
#bd_snap a{font:13px arial;color:#00c;text-decoration:underline}
#bd_snap_note a{color:#999}
#bd_snap_head{width:860px;height:44px}
#bd_snap_logo{width:162px;height:38px;display:block;background:url(logo-snap.png) no-repeat;margin-right:15px;float:left}
#bd_snap_search{width:680px;position:absolute;left:209px;top:17px}
#bd_snap_kw{width:531px;margin-right: 0;height:24px;padding:4px 7px;padding:6px 7px 2px\9;font:16px arial;vertical-align:top;border: 1px solid #b6b6b6;border-color: #7b7b7b #b6b6b6 #b6b6b6 #7b7b7b;background: #fff;display:inline-block;border-right-width: 0;border-color: #b8b8b8 transparent #ccc #b8b8b8;overflow: hidden;outline:0}
#bd_snap_kw:hover{border-color: #999 transparent #b3b3b3 #999;}
#bd_snap_kw:focus{border-color: #4791ff transparent #4791ff #4791ff}
#bd_snap_su{width:100px;height:34px;font-size:14px;color:#fff;padding:0;letter-spacing: 1px;background: #3385ff; border-bottom: 1px solid #2d78f4;outline: medium;-webkit-appearance: none;-webkit-border-radius: 0;cursor:pointer;border:0}
#bd_snap_search input.bd_snap_btn_h{background: #3075dc;box-shadow: inset 1px 1px 3px #2964bb;-webkit-box-shadow: inset 1px 1px 3px #2964bb;-moz-box-shadow: inset 1px 1px 3px #2964bb;-o-box-shadow: inset 1px 1px 3px #2964bb;}
#bd_snap_search input.btnhover{background: #317ef3;border-bottom: 1px solid #2868c8;box-shadow: 1px 1px 1px #ccc;}
#bd_snap_btn_wr{width:97px;height:34px;display:inline-block;_top:1px;*position:relative}
#bd_snap_ln{height:1px;border-top:1px solid #ACA899;background:#ECE9D8;overflow:hidden}
#bd_snap_txt span a{text-decoration:none}
</style>


</head><body><div id="bd_snap">
    <div id="bd_snap_head">
        <a href="http://www.baidu.com/" id="bd_snap_logo" title="到百度首页"></a>
    </div>
    <div id="bd_snap_txt">您查询的关键词是：<span><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419.htm#baidusnap0" style="color:black;background-color:#ffff66;padding:0 3px;font-weight:bold">matching</a><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419.htm#baidusnap1" style="color:black;background-color:#A0FFFF;padding:0 3px;font-weight:bold">query</a><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419.htm#baidusnap2" style="color:black;background-color:#99ff99;padding:0 3px;font-weight:bold">does</a><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419.htm#baidusnap3" style="color:black;background-color:#ff9999;padding:0 3px;font-weight:bold">not</a><a href="c_m_9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419.htm#baidusnap4" style="color:black;background-color:#ff66ff;padding:0 3px;font-weight:bold">exist</a></span>  <span style="margin-left:5px">以下是该网页在北京时间 2015年11月20日 05:05:39 的快照；</span>
        <p>如果打开速度慢，可以尝试<a href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419ce3b4611193bb6a6767f4c4284993a7a01ac4f5df7e4732f77552fe8c88ed91086e7c73f2ff96473275ccd5612a24ff29c0732c151cc07afb81996edba69d2e8&amp;p=c039c64ad49e02ea08e2947d0e4fc4&amp;newp=882a9546d58007ee1eb4c7710f4086231610db2151d4d7163c92d20eca&amp;user=baidu&amp;fm=sc&amp;query=matching+query+does+not+exist&amp;qid=9d810e520000eef9&amp;p1=1&amp;fast=y">快速版</a>；如果想保存快照，可以<a href="http://cang.baidu.com/do/add" onclick="window.open(&#x27;http://cang.baidu.com/do/add?it=&#x27;+encodeURIComponent(document.title)+&#x27;&amp;iu=&#x27;+encodeURIComponent(location.href)+&#x27;&amp;fr=ps#nw=1&#x27;,&#x27;_s&#x27;,&#x27;scrollbars=no,width=600,height=450,right=75,top=20,status=no,resizable=yes&#x27;); return false;" target="_blank">添加到搜藏</a>；如果想更新或删除快照，可以<a href="http://tousu.baidu.com/webmaster/add?link=http%3A%2F%2Fcache.baiducontent.com%2Fc%3Fm%3D9f65cb4a8c8507ed4fece763105392230e54f72b6b90975f68d4e419ce3b4611193bb6a6767f4c4284993a7a01ac4f5df7e4732f77552fe8c88ed91086e7c73f2ff96473275ccd5612a24ff29c0732c151cc07afb81996edba69d2e8%26p%3Dc039c64ad49e02ea08e2947d0e4fc4%26newp%3D882a9546d58007ee1eb4c7710f4086231610db2151d4d7163c92d20eca%26user%3Dbaidu%26fm%3Dsc%26query%3Dmatching%2Bquery%2Bdoes%2Bnot%2Bexist%26qid%3D9d810e520000eef9%26p1%3D1" id="bd_tousu">投诉快照</a>。
        </p>
    </div>
<script>document.getElementById("bd_tousu").href = "http://tousu.baidu.com/webmaster/add?link=" + encodeURIComponent(document.location);</script>
    <div id="bd_snap_note">百度和网页 <a href="http://www.zeuux.com/blog/content/2143/">http://www.zeuux.com/blog/content/2143/</a> 的作者无关，不对其内容负责。百度快照谨为网络故障时之索引，不代表被搜索网站的即时页面。</div>
</div>
<div id="bd_snap_search">
	<form action="http://www.baidu.com/s"><input name="cl" type="hidden" value="3"><input id="bd_snap_kw" maxlength="100" name="wd" value=""><span id="bd_snap_btn_wr"><input class="bd_snap_btn" id="bd_snap_su" onmousedown="this.className=&#x27;bd_snap_btn btnhover&#x27;" onmouseout="this.className=&#x27;bd_snap_btn&#x27;" onmouseover="this.className=&#x27;bd_snap_btn bd_snap_btn_h&#x27;" onmouseup="this.className=&#x27;bd_snap_btn&#x27;" type="submit" value="百度一下"></span></form>
</div>
<div id="bd_snap_ln"></div>
<div style="position:relative">








  
	<title>


何一的博客:Django模型(model)详细介绍2


 - 哲思</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <!-- Fav and touch icons -->
    <meta content="yes" name="apple-mobile-web-app-capable">

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta content="RepYQ0JZMq" name="baidu-site-verification">
    <meta content="54537bc814db1d66657cbf368df8dba0" name="baidu-tc-verification">

    <link href="favicon.ico" rel="Shortcut Icon" type="image/x-icon">
	<link href="http://style.zeuux.com/style/base/css/base.css?v=2.0.9" rel="stylesheet" type="text/css">

    <link href="http://style.zeuux.com/asset/css/bootstrap.css?v=2.0.9" rel="stylesheet">
    <link href="http://style.zeuux.com/asset/css/bootstrap-theme.css?v=2.0.9" rel="stylesheet">
    
	<link href="component.css_v_2.0.9.css" rel="stylesheet" type="text/css">
	<link href="http://style.zeuux.com/style/classic/css/skin.css?v=2.0.9" rel="stylesheet" type="text/css">

    <link href="app.css_v_2.0.9.css" rel="stylesheet">
	
<link href="blog.css_v_2.0.9.css" rel="stylesheet" type="text/css">
<link href="friends.css_v_2.0.9.css" rel="stylesheet" type="text/css">
<link href="shCore.css_v_2.0.9.css" rel="stylesheet" type="text/css">
<link href="http://style.zeuux.com/style/base/css/shThemeDefault.css?v=2.0.9" rel="stylesheet" type="text/css">

	
	
  

  
      


<div class="header-wrapper">
    <div class="container">
        <nav class="navbar navbar-default" role="navigation" style="background-color: #e9e9e9;border-radius: 0;box-shadow: none;-webkit-box-shadow: none;border-width:0;margin-bottom:0; min-height: 40px;">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <a class="navbar-brand" href="index.jpg">Zeuux哲思</a>
                </div>
            </div>
            
            <div class="collapse navbar-collapse" style="background-color: #e9e9e9;">
                

                <ul class="nav navbar-nav navbar-right" style="padding-top: 3px; padding-bottom: 3px;">
                    
                    <li><a href="/login/">登录</a></li>
                    <li><a href="/register/">注册</a></li>
                    
                </ul>
                
            </div>

        </nav>
    </div>
</div>

	<div class="zeuux">
	  <div class="ad-top"></div>
	  


<div class="notify" id="id_base_notify_container" style="display:none;">
  <div class="body success" id="id_base_notify_body">
    <span class="close" id="id_base_notify_close"><a href="javascript:void(0);" onclick="javascript:GlobalNoticeModule.close();">关闭</a></span>
    <span class="message" id="id_base_notify_message"></span>
  </div>
</div>


	  
	  <div class="zeuux-main-new">
		
		<div class="zeuux-frame" style="border:0px;background:none;">
		  <div class="SG_conn">
			
<div class="zeuux-blog-list SG_colW735 common_page">
  <div class="common_page_header">
    

<a href="http://www.zeuux.com/home/lantianlz/"><img alt="何一" class="avatars" src="http://style.zeuux.com/style/base/images/default-head-4-small.gif" style="border:0;" title="去何一的个人主页"></a>



    <p class="title">
      <strong>何一的博客</strong>
    </p>
    <p>
      <a class="underline" href="/home/lantianlz/">他的个人主页</a>&#xa0;
      <a class="underline" href="/blog/user/lantianlz/">他的博客</a>
    </p>
  </div>

  <div class="zeuux-bg-2" style="background:none;">
    <div class="blog-detail SG_colW735">

      <!-- deleted -->
      
      
      <!-- check the privacy -->
      

      <div class="blog-review-bg-bottom">
	<div class="tag-flow">
	  
	  <!-- notice section -->
	  

	  <!-- content -->
	  <h1 class="blog-detail-h1">Djang<wbr>o模型(m<wbr>odel)<wbr>详细介绍2<wbr></h1>
	  <p class="blog-detail-info">
	    
<a class="username" href="http://www.zeuux.com/home/lantianlz/" title="何一" userid="lantianlz">何一</a>

&#xa0;2009年12月14日 星期一 22:53&#xa0;|&#xa0;19940次浏览&#xa0;|&#xa0;2条评论
	  </p>
	  
	  
	  <div class="blog-detail-summary">
	    <p>接续上一篇<wbr>日志，感谢<wbr>大家的翻译<wbr><br>摘自T<wbr>he Django Book，积累点滴</p>
	  </div>
	  

	  <div class="rich-content">
	    <div class="section" id="id7">
 <h2 class="cn" id="cn150">
  -----------------------华丽的分割线--------------------------
  <br>
 </h2>
 <h2 class="cn">
  基本数据访问
 </h2>
 <p class="cn" id="cn151">
  一旦你创建了模型，Django自动为这些模型提供了高级的Python API。 运行
  <tt class="docutils literal">
   <span class="pre">
    python
   </span>
   <span class="pre">
    manage.py
   </span>
   <span class="pre">
    shell
   </span>
  </tt>
  并输入下面的内容试试看：
 </p>
 <pre class="cn literal-block" id="cn153">  &gt;&gt;&gt; from books.models import Publisher
  <br>
  &gt;&gt;&gt; p1 = Publisher(name=&#x27;Apress&#x27;, address=&#x27;2855 Telegraph Avenue&#x27;,
  <br>
  ...     city=&#x27;Berkeley&#x27;, state_province=&#x27;CA&#x27;, country=&#x27;U.S.A.&#x27;,
  <br>
  ...     website=&#x27;http://www.apress.com/&#x27;)
  <br>
  &gt;&gt;&gt; p1.save()
  <br>
  &gt;&gt;&gt; p2 = Publisher(name=&quot;O&#x27;Reilly&quot;, address=&#x27;10 Fawcett St.&#x27;,
  <br>
  ...     city=&#x27;Cambridge&#x27;, state_province=&#x27;MA&#x27;, country=&#x27;U.S.A.&#x27;,
  <br>
  ...     website=&#x27;http://www.oreilly.com/&#x27;)
  <br>
  &gt;&gt;&gt; p2.save()
  <br>
  &gt;&gt;&gt; publisher_list = Publisher.objects.all()
  <br>
  &gt;&gt;&gt; publisher_list
  <br>
  [&lt;Publisher: Publisher object&gt;, &lt;Publisher: Publisher object&gt;]
  <br>
 </pre>
 <p class="cn" id="cn154">
  这短短几行代码干了不少的事。 这里简单的说一下：
 </p>
 <ul class="simple">
  <li class="cn" id="cn155">
   <p class="first cn" id="cn155">
    首先，导入Publisher模型类， 通过这个类我们可以与包含 出版社 的数据表进行交互。
   </p>
  </li>
 </ul>
 <ul class="simple">
  <li class="cn" id="cn156">
   <p class="first cn" id="cn156">
    接着，创建一个`` Publisher`` 类的实例并设置了字段`` name, address`` 等的值。
   </p>
  </li>
 </ul>
 <ul class="simple">
  <li class="cn" id="cn157">
   <p class="first cn" id="cn157">
    调用该对象的
    <tt class="docutils literal">
     <span class="pre">
      save()
     </span>
    </tt>
    方法，将对象保存到数据库中。 Django 会在后台执行一条
    <tt class="docutils literal">
     <span class="pre">
      INSERT
     </span>
    </tt>
    语句。
   </p>
  </li>
 </ul>
 <ul class="simple">
  <li class="cn" id="cn158">
   <p class="first cn" id="cn158">
    最后，使用`` Publisher.objects`` 属性从数据库取出出版商的信息，这个属性可以认为是包含出版商的记录集。 这个属性有许多方法， 这里先介绍调用`` Publisher.objects.all()`` 方法获取数据库中`` Publisher`` 类的所有对象。这个操作的幕后，Django执行了一条SQL `` SELECT`` 语句。
   </p>
  </li>
 </ul>
 <p class="cn" id="cn159">
  这里有一个值得注意的地方，在这个例子可能并未清晰地展示。 当你使用Django modle API创建对象时Django并未将对象保存至数据库内，除非你调用`` save()`` 方法：
 </p>
 <pre class="cn literal-block" id="cn161">  p1 = Publisher(...)
  <br>
  # At this point, p1 is <a name="baidusnap3"></a><b style="color:black;background-color:#ff9999">not</b> saved to the database yet!
  <br>
  p1.save()
  <br>
  # Now it is.
  <br>
 </pre>
 <p class="cn" id="cn162">
  如果需要一步完成对象的创建与存储至数据库，就使用`` objects.create()`` 方法。 下面的例子与之前的例子等价：
 </p>
 <pre class="cn literal-block" id="cn164">  &gt;&gt;&gt; p1 = Publisher.objects.create(name=&#x27;Apress&#x27;,
  <br>
  ...     address=&#x27;2855 Telegraph Avenue&#x27;,
  <br>
  ...     city=&#x27;Berkeley&#x27;, state_province=&#x27;CA&#x27;, country=&#x27;U.S.A.&#x27;,
  <br>
  ...     website=&#x27;http://www.apress.com/&#x27;)
  <br>
  &gt;&gt;&gt; p2 = Publisher.objects.create(name=&quot;O&#x27;Reilly&quot;,
  <br>
  ...     address=&#x27;10 Fawcett St.&#x27;, city=&#x27;Cambridge&#x27;,
  <br>
  ...     state_province=&#x27;MA&#x27;, country=&#x27;U.S.A.&#x27;,
  <br>
  ...     website=&#x27;http://www.oreilly.com/&#x27;)
  <br>
  &gt;&gt;&gt; publisher_list = Publisher.objects.all()
  <br>
  &gt;&gt;&gt; publisher_list
  <br>
 </pre>
 <p class="cn" id="cn165">
  自然，你肯定想执行更多的Django数据库API试试看，不过，还是让我们先解决一点烦人的小问题。
 </p>
</div>
<div class="section" id="id8">
 <h2 class="cn" id="cn166">
  添加模块的字符串表现
 </h2>
 <p class="cn" id="cn167">
  当我们打印整个publisher列表时，我们没有得到想要的有用的信息：
 </p>
 <pre class="cn literal-block" id="cn169">  [&lt;Publisher: Publisher object&gt;, &lt;Publisher: Publisher object&gt;]
  <br>
 </pre>
 <p class="cn" id="cn170">
  我们可以简单解决这个问题，只需要添加一个方法
  <tt class="docutils literal">
   <span class="pre">
    __unicode__()
   </span>
  </tt>
  到
  <tt class="docutils literal">
   <span class="pre">
    Publisher
   </span>
  </tt>
  对象。
  <tt class="docutils literal">
   <span class="pre">
    __unicode__()
   </span>
  </tt>
  方法告诉Python如何实现对象的unicode表示。 请看下面：
 </p>
 <pre class="cn literal-block" id="cn172">  from django.db import models
  <br>
  <br>
  class Publisher(models.Model):
  <br>
  name = models.CharField(max_length=30)
  <br>
  address = models.CharField(max_length=50)
  <br>
  city = models.CharField(max_length=60)
  <br>
  state_province = models.CharField(max_length=30)
  <br>
  country = models.CharField(max_length=50)
  <br>
  website = models.URLField()
  <br>
  <br>
  **def __unicode__(self):**
  <br>
  **return self.name**
  <br>
  <br>
  class Author(models.Model):
  <br>
  first_name = models.CharField(max_length=30)
  <br>
  last_name = models.CharField(max_length=40)
  <br>
  email = models.EmailField()
  <br>
  <br>
  **def __unicode__(self):**
  <br>
  **return u&#x27;%s %s&#x27; % (self.first_name, self.last_name)**
  <br>
  <br>
  class Book(models.Model):
  <br>
  title = models.CharField(max_length=100)
  <br>
  authors = models.ManyToManyField(Author)
  <br>
  publisher = models.ForeignKey(Publisher)
  <br>
  publication_date = models.DateField()
  <br>
  <br>
  **def __unicode__(self):**
  <br>
  **return self.title**
  <br>
 </pre>
 <p class="cn" id="cn173">
  就象你看到的一样，
  <tt class="docutils literal">
   <span class="pre">
    __unicode__()
   </span>
  </tt>
  方法可以进行任何处理来返回对一个对象的表示。
  <tt class="docutils literal">
   <span class="pre">
    __str__()
   </span>
  </tt>
  必须返回字符串， 如果是其他类型，Python将会抛出
  <tt class="docutils literal">
   <span class="pre">
    TypeError
   </span>
  </tt>
  错误消息
  <tt class="docutils literal">
   <span class="pre">
    &quot;__str__
   </span>
   <span class="pre">
    returned
   </span>
   <span class="pre">
    non-string&quot;
   </span>
  </tt>
  出来。
 </p>
 <p class="cn" id="cn174">
  对__unicode__()的唯一要求就是它要返回一个unicode对象 如果`` __unicode__()`` 方法未返回一个Unicode对象，而返回比如说一个整型数字，那么Python将抛出一个`` TypeError`` 错误，并提示：”coercing to Unicode: need string or buffer, int found” 。
 </p>
 <p class="cn" id="cn175">
  Unicode对象
 </p>
 <p class="cn" id="cn176">
  什么是Unicode对象呢？
 </p>
 <p class="cn" id="cn177">
  你可以认为一个unicode对象就是一个python的可以处理不仅上百万不同类别字符的字符串――从古老版本的Latin字符到非Latin字符，再到曲折的引用和艰涩的符号。
 </p>
 <p class="cn" id="cn178">
  普通的python字符串是经过
  <a href="http://djangobook.py3k.cn/2.0/chapter05/#id9" target="_blank">
   <span class="problematic" id="id10">
    **
   </span>
  </a>
  ， 意思就是它们已经经过某种编码（如ASCII，ISO-8859-1或者UTF-8）来编码。 如果你在保存奇特的字符（其它任何超出标准128个如0-9和A-Z之类的ASCII字符）在一个普通的python字符串里，你一定要跟踪你的字符串是 用什么编码的，否则这些奇特的字符可能会在显示或者打印的时候出现乱码。 当你尝试要将用某种编码保存的数据结合到另外一种编码的数据中，或者你想要把它显示在已经假定了某种编码的程序中的时候，问题就会发生。 我们都已经见到过网页和邮件被???弄得乱七八糟。 ?????? 或者其它出现在奇怪位置的字符：这一般来说就是存在编码问题了。
 </p>
 <div class="system-message" id="id9">
  <p class="system-message-title">
   System Message: WARNING/2 (
   <tt class="docutils">
    &lt;string&gt;
   </tt>
   , line 944);
   <em>
    <a href="http://djangobook.py3k.cn/2.0/chapter05/#id10" target="_blank">
     backlink
    </a>
   </em>
  </p>
  <p class="cn" id="cn178">
   Inline strong start-string without end-string.
  </p>
 </div>
 <p class="cn" id="cn179">
  但是Unicode对象并没有编码。它们使用Unicode，一个一致的，通用的字符编码集。 当你在Python中处理Unicode对象的时候，你可以直接将它们混合使用和互相匹配而不必去考虑编码细节。
 </p>
 <p class="cn" id="cn180">
  Django 在其内部的各个方面都使用到了 Unicode 对象。 模型 对象中，检索匹配方面的操作使用的是 Unicode 对象，视图 函数之间的交互使用的是 Unicode 对象，模板的渲染也是用的 Unicode 对象。 通常，我们不必担心编码是否正确，后台会处理的很好。
 </p>
 <p class="cn" id="cn181">
  注意，我们这里只是对Unicode对象进行非常浅显的概述，若要深入了解你可能需要查阅相关的资料。 一个很好的起点在：http://www.joelonsoftware.com/articles/Unicode.html。
 </p>
 <p class="cn" id="cn182">
  为了让我们的修改生效，先退出Python Shell，然后再次运行
  <tt class="docutils literal">
   <span class="pre">
    python
   </span>
   <span class="pre">
    manage.py
   </span>
   <span class="pre">
    shell
   </span>
  </tt>
  进入。
 </p>
 <pre class="cn literal-block" id="cn184">  &gt;&gt;&gt; from books.models import Publisher
  <br>
  &gt;&gt;&gt; publisher_list = Publisher.objects.all()
  <br>
  &gt;&gt;&gt; publisher_list
  <br>
  [&lt;Publisher: Apress&gt;, &lt;Publisher: O&#x27;Reilly&gt;]
  <br>
 </pre>
 <p class="cn" id="cn185">
  请确保你的每一个模型里都包含
  <tt class="docutils literal">
   <span class="pre">
    __unicode__()
   </span>
  </tt>
  方法，这不只是为了交互时方便，也是因为 Django会在其他一些地方用
  <tt class="docutils literal">
   <span class="pre">
    __unicode__()
   </span>
  </tt>
  来显示对象。
 </p>
 <p class="cn" id="cn186">
  最后，
  <tt class="docutils literal">
   <span class="pre">
    __unicode()__
   </span>
  </tt>
  也是一个很好的例子来演示我们怎么添加
  <em>
   行为
  </em>
  到模型里。 Django的模型不只是为对象定义了数据库表的结构，还定义了对象的行为。
  <tt class="docutils literal">
   <span class="pre">
    __unicode__()
   </span>
  </tt>
  就是一个例子来演示模型知道怎么显示它们自己。
 </p>
</div>
<div class="section" id="id11">
 <h2 class="cn" id="cn187">
  插入和更新数据
 </h2>
 <p class="cn" id="cn188">
  你已经知道怎么做了： 先使用一些关键参数创建对象实例，如下：
 </p>
 <pre class="cn literal-block" id="cn190">  &gt;&gt;&gt; p = Publisher(name=&#x27;Apress&#x27;,
  <br>
  ...         address=&#x27;2855 Telegraph Ave.&#x27;,
  <br>
  ...         city=&#x27;Berkeley&#x27;,
  <br>
  ...         state_province=&#x27;CA&#x27;,
  <br>
  ...         country=&#x27;U.S.A.&#x27;,
  <br>
  ...         website=&#x27;http://www.apress.com/&#x27;)
  <br>
 </pre>
 <p class="cn" id="cn191">
  这个对象实例并
  <em>
   没有
  </em>
  对数据库做修改。 在调用`` save()`` 方法之前，记录并没有保存至数据库，像这样：
 </p>
 <pre class="cn literal-block" id="cn193">  &gt;&gt;&gt; p.save()
  <br>
 </pre>
 <p class="cn" id="cn194">
  在SQL里，这大致可以转换成这样：
 </p>
 <pre class="cn literal-block" id="cn196">  INSERT INTO books_publisher
  <br>
  (name, address, city, state_province, country, website)
  <br>
  VALUES
  <br>
  (&#x27;Apress&#x27;, &#x27;2855 Telegraph Ave.&#x27;, &#x27;Berkeley&#x27;, &#x27;CA&#x27;,
  <br>
  &#x27;U.S.A.&#x27;, &#x27;http://www.apress.com/&#x27;);
  <br>
 </pre>
 <p class="cn" id="cn197">
  因为
  <tt class="docutils literal">
   <span class="pre">
    Publisher
   </span>
  </tt>
  模型有一个自动增加的主键
  <tt class="docutils literal">
   <span class="pre">
    id
   </span>
  </tt>
  ，所以第一次调用
  <tt class="docutils literal">
   <span class="pre">
    save()
   </span>
  </tt>
  还多做了一件事： 计算这个主键的值并把它赋值给这个对象实例：
 </p>
 <pre class="cn literal-block" id="cn199">  &gt;&gt;&gt; p.id
  <br>
  52    # this will differ based on your own data
  <br>
 </pre>
 <p class="cn" id="cn200">
  接下来再调用
  <tt class="docutils literal">
   <span class="pre">
    save()
   </span>
  </tt>
  将不会创建新的记录，而只是修改记录内容（也就是 执行
  <tt class="docutils literal">
   <span class="pre">
    UPDATE
   </span>
  </tt>
  SQL语句，而不是
  <tt class="docutils literal">
   <span class="pre">
    INSERT
   </span>
  </tt>
  语句）：
 </p>
 <pre class="cn literal-block" id="cn202">  &gt;&gt;&gt; p.name = &#x27;Apress Publishing&#x27;
  <br>
  &gt;&gt;&gt; p.save()
  <br>
 </pre>
 <p class="cn" id="cn203">
  前面执行的
  <tt class="docutils literal">
   <span class="pre">
    save()
   </span>
  </tt>
  相当于下面的SQL语句：
 </p>
 <pre class="cn literal-block" id="cn205">  UPDATE books_publisher SET
  <br>
  name = &#x27;Apress Publishing&#x27;,
  <br>
  address = &#x27;2855 Telegraph Ave.&#x27;,
  <br>
  city = &#x27;Berkeley&#x27;,
  <br>
  state_province = &#x27;CA&#x27;,
  <br>
  country = &#x27;U.S.A.&#x27;,
  <br>
  website = &#x27;http://www.apress.com&#x27;
  <br>
  WHERE id = 52;
  <br>
 </pre>
 <p class="cn" id="cn206">
  注意，并不是只修改来期望的那个字段，所有的字段都会被更新。 这个操作有可能引起竞态条件，取决于你的应用程序。 参阅后面的“更新多个对象”小节查看以下的查询与“更新多个对象”使用的方法之间的不同。
 </p>
 <pre class="cn literal-block" id="cn208">  UPDATE books_publisher SET
  <br>
  name = &#x27;Apress Publishing&#x27;
  <br>
  WHERE id=52;
  <br>
 </pre>
</div>
<div class="section" id="id12">
 <h2 class="cn" id="cn209">
  选择对象
 </h2>
 <p class="cn" id="cn210">
  当然，创建新的数据库，并更新之中的数据是必要的，但是，对于 Web 应用程序来说，更多的时候是在检索查询数据库。 我们已经知道如何从一个给定的模型中取出所有记录：
 </p>
 <pre class="cn literal-block" id="cn212">  &gt;&gt;&gt; Publisher.objects.all()
  <br>
  [&lt;Publisher: Apress&gt;, &lt;Publisher: O&#x27;Reilly&gt;]
  <br>
 </pre>
 <p class="cn" id="cn213">
  这相当于这个SQL语句：
 </p>
 <pre class="cn literal-block" id="cn215">  SELECT id, name, address, city, state_province, country, website
  <br>
  FROM books_publisher;
  <br>
 </pre>
 <p class="cn" id="cn216">
  注意
 </p>
 <p class="cn" id="cn217">
  注意到Django在选择所有数据时并没有使用
  <tt class="docutils literal">
   <span class="pre">
    SELECT*
   </span>
  </tt>
  ，而是显式列出了所有字段。 就是这样设计的：
  <tt class="docutils literal">
   <span class="pre">
    SELECT*
   </span>
  </tt>
  会更慢，而且最重要的是列出所有字段遵循了Python 界的一个信条： 明确比不明确好。
 </p>
 <p class="cn" id="cn218">
  有关Python之禅(戒律) :-），在Python提示行输入
  <tt class="docutils literal">
   <span class="pre">
    import
   </span>
   <span class="pre">
    this
   </span>
  </tt>
  试试看。
 </p>
 <p class="cn" id="cn219">
  让我们来仔细看看
  <tt class="docutils literal">
   <span class="pre">
    Publisher.objects.all()
   </span>
  </tt>
  这行的每个部分：
 </p>
 <blockquote>
  <p class="cn" id="cn220">
   首先，我们有一个已定义的模型
   <tt class="docutils literal">
    <span class="pre">
     Publisher
    </span>
   </tt>
   。没什么好奇怪的： 你想要查找数据， 你就用模型来获得数据。
  </p>
  <p class="cn" id="cn221">
   其次，
   <tt class="docutils literal">
    <span class="pre">
     objects
    </span>
   </tt>
   是干什么的？ 它被称为管理器，我们将在第10章中详细讨论它。 目前，我们只需了解管理器管理着所有针对数据包含、还有最重要的数据查询的表格级操作。
  </p>
  <p class="cn" id="cn222">
   所有的模型都自动拥有一个
   <tt class="docutils literal">
    <span class="pre">
     objects
    </span>
   </tt>
   管理器；你可以在想要查找数据时是使用它。
  </p>
  <p class="cn" id="cn223">
   最后，还有
   <tt class="docutils literal">
    <span class="pre">
     all()
    </span>
   </tt>
   方法。 这是
   <tt class="docutils literal">
    <span class="pre">
     objects
    </span>
   </tt>
   管理器返回所有记录的一个方法。 尽管这个对象
   <em>
    看起来
   </em>
   象一个列表（list），它实际是一个
   <em>
    QuerySet
   </em>
   对象， 这个对象是数据库中一些记录的集合。 附录C将详细描述QuerySet，现在，我们 就先当它是一个仿真列表对象好了。
  </p>
 </blockquote>
 <p class="cn" id="cn224">
  所有的数据库查找都遵循一个通用模式：
 </p>
 <div class="section" id="id13">
  <h3 class="cn" id="cn225">
   数据过滤
  </h3>
  <p class="cn" id="cn226">
   我们很少会一次性从数据库中取出所有的数据；通常都只针对一部分数据进行操作。 在Django API中，我们可以使用`` filter()`` 方法对数据进行过滤：
  </p>
  <pre class="cn literal-block" id="cn228">   &gt;&gt;&gt; Publisher.objects.filter(name=&#x27;Apress&#x27;)
   <br>
   [&lt;Publisher: Apress&gt;]
   <br>
  </pre>
  <p class="cn" id="cn229">
   <tt class="docutils literal">
    <span class="pre">
     filter()
    </span>
   </tt>
   根据关键字参数来转换成
   <tt class="docutils literal">
    <span class="pre">
     WHERE
    </span>
   </tt>
   SQL语句。 前面这个例子 相当于这样：
  </p>
  <pre class="cn literal-block" id="cn231">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   WHERE name = &#x27;Apress&#x27;;
   <br>
  </pre>
  <p class="cn" id="cn232">
   你可以传递多个参数到
   <tt class="docutils literal">
    <span class="pre">
     filter()
    </span>
   </tt>
   来缩小选取范围：
  </p>
  <pre class="cn literal-block" id="cn234">   &gt;&gt;&gt; Publisher.objects.filter(country=&quot;U.S.A.&quot;, state_province=&quot;CA&quot;)
   <br>
   [&lt;Publisher: Apress&gt;]
   <br>
  </pre>
  <p class="cn" id="cn235">
   多个参数会被转换成
   <tt class="docutils literal">
    <span class="pre">
     AND
    </span>
   </tt>
   SQL语句， 因此上面的代码可以转化成这样：
  </p>
  <pre class="cn literal-block" id="cn237">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   WHERE country = &#x27;U.S.A.&#x27;
   <br>
   AND state_province = &#x27;CA&#x27;;
   <br>
  </pre>
  <p class="cn" id="cn238">
   注意，SQL缺省的
   <tt class="docutils literal">
    <span class="pre">
     =
    </span>
   </tt>
   操作符是精确匹配的， 包含性查找可以使用：
  </p>
  <pre class="cn literal-block" id="cn240">   &gt;&gt;&gt; Publisher.objects.filter(name__contains=&quot;press&quot;)
   <br>
   [&lt;Publisher: Apress&gt;]
   <br>
  </pre>
  <p class="cn" id="cn241">
   在
   <tt class="docutils literal">
    <span class="pre">
     name
    </span>
   </tt>
   和
   <tt class="docutils literal">
    <span class="pre">
     contains
    </span>
   </tt>
   之间有双下划线。
  </p>
  <pre class="cn literal-block" id="cn243">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   WHERE name LIKE &#x27;%press%&#x27;;
   <br>
  </pre>
  <p class="cn" id="cn244">
   其他的一些查找类型有：
   <tt class="docutils literal">
    <span class="pre">
     icontains
    </span>
   </tt>
   (大小写无关的
   <tt class="docutils literal">
    <span class="pre">
     LIKE
    </span>
   </tt>
   ),
   <tt class="docutils literal">
    <span class="pre">
     startswith
    </span>
   </tt>
   和
   <tt class="docutils literal">
    <span class="pre">
     endswith
    </span>
   </tt>
   , 还有
   <tt class="docutils literal">
    <span class="pre">
     range
    </span>
   </tt>
   (SQL
   <tt class="docutils literal">
    <span class="pre">
     BETWEEN
    </span>
   </tt>
   查询）。
  </p>
 </div>
 <div class="section" id="id14">
  <h3 class="cn" id="cn245">
   获取单个对象
  </h3>
  <p class="cn" id="cn246">
   上面的例子中`` filter()`` 函数返回一个记录集，这个记录集是一个列表。 相对列表来说，有些时候我们更需要获取单个的对象， `` get()`` 方法就是在此时使用的：
  </p>
  <pre class="cn literal-block" id="cn248">   &gt;&gt;&gt; Publisher.objects.get(name=&quot;Apress&quot;)
   <br>
   &lt;Publisher: Apress&gt;
   <br>
  </pre>
  <p class="cn" id="cn249">
   这样，就返回了单个对象，而不是列表（更准确的说，QuerySet)。 所以，如果结果是多个对象，会导致抛出异常：
  </p>
  <pre class="cn literal-block" id="cn251">   &gt;&gt;&gt; Publisher.objects.get(country=&quot;U.S.A.&quot;)
   <br>
   Traceback (most recent call last):
   <br>
   ...
   <br>
   MultipleObjectsReturned: get() returned more than one Publisher --
   <br>
   it returned 2! Lookup parameters were {&#x27;country&#x27;: &#x27;U.S.A.&#x27;}
   <br>
  </pre>
  <p class="cn" id="cn252">
   如果查询没有返回结果也会抛出异常：
  </p>
  <pre class="cn literal-block" id="cn254">   &gt;&gt;&gt; Publisher.objects.get(name=&quot;Penguin&quot;)
   <br>
   Traceback (most recent call last):
   <br>
   ...
   <br>
   DoesNotExist: Publisher <a name="baidusnap0"></a><b style="color:black;background-color:#ffff66">matching</b> <a name="baidusnap1"></a><b style="color:black;background-color:#A0FFFF">query</b> <a name="baidusnap2"></a><b style="color:black;background-color:#99ff99">does</b> <b style="color:black;background-color:#ff9999">not</b> <a name="baidusnap4"></a><b style="color:black;background-color:#ff66ff">exist</b>.
   <br>
  </pre>
  <p class="cn" id="cn255">
   这个
   <tt class="docutils literal">
    <span class="pre">
     DoesNotExist
    </span>
   </tt>
   异常 是 Publisher 这个 model 类的一个属性，即
   <tt class="docutils literal">
    <span class="pre">
     Publisher.DoesNotExist
    </span>
   </tt>
   。在你的应用中，你可以捕获并处理这个异常，像这样：
  </p>
  <pre class="cn literal-block" id="cn257">   try:
   <br>
   p = Publisher.objects.get(name=&#x27;Apress&#x27;)
   <br>
   except Publisher.DoesNotExist:
   <br>
   print &quot;Apress isn&#x27;t in the database yet.&quot;
   <br>
   else:
   <br>
   print &quot;Apress is in the database.&quot;
   <br>
  </pre>
 </div>
 <div class="section" id="id15">
  <h3 class="cn" id="cn258">
   数据排序
  </h3>
  <p class="cn" id="cn259">
   在运行前面的例子中，你可能已经注意到返回的结果是无序的。 我们还没有告诉数据库 怎样对结果进行排序，所以我们返回的结果是无序的。
  </p>
  <p class="cn" id="cn260">
   在你的 Django 应用中，你或许希望对检索结果，根据某字段的值，按字母顺序排序。 那么，使用
   <tt class="docutils literal">
    <span class="pre">
     order_by()
    </span>
   </tt>
   这个方法就可以搞定了。
  </p>
  <pre class="cn literal-block" id="cn262">   &gt;&gt;&gt; Publisher.objects.order_by(&quot;name&quot;)
   <br>
   [&lt;Publisher: Apress&gt;, &lt;Publisher: O&#x27;Reilly&gt;]
   <br>
  </pre>
  <p class="cn" id="cn263">
   跟以前的
   <tt class="docutils literal">
    <span class="pre">
     all()
    </span>
   </tt>
   例子差不多，SQL语句里多了指定排序的部分：
  </p>
  <pre class="cn literal-block" id="cn265">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   ORDER BY name;
   <br>
  </pre>
  <p class="cn" id="cn266">
   我们可以对任意字段进行排序：
  </p>
  <pre class="cn literal-block" id="cn268">   &gt;&gt;&gt; Publisher.objects.order_by(&quot;address&quot;)
   <br>
   [&lt;Publisher: O&#x27;Reilly&gt;, &lt;Publisher: Apress&gt;]
   <br>
   <br>
   &gt;&gt;&gt; Publisher.objects.order_by(&quot;state_province&quot;)
   <br>
   [&lt;Publisher: Apress&gt;, &lt;Publisher: O&#x27;Reilly&gt;]
   <br>
  </pre>
  <p class="cn" id="cn269">
   如果需要以多个字段为标准进行排序（第二个字段会在第一个字段的值相同的情况下被使用到），使用多个参数就可以了，如下：
  </p>
  <pre class="cn literal-block" id="cn271">   &gt;&gt;&gt; Publisher.objects.order_by(&quot;state_province&quot;, &quot;address&quot;)
   <br>
   [&lt;Publisher: Apress&gt;, &lt;Publisher: O&#x27;Reilly&gt;]
   <br>
  </pre>
  <p class="cn" id="cn272">
   我们还可以指定逆向排序，在前面加一个减号
   <tt class="docutils literal">
    <span class="pre">
     -
    </span>
   </tt>
   前缀：
  </p>
  <pre class="cn literal-block" id="cn274">   &gt;&gt;&gt; Publisher.objects.order_by(&quot;-name&quot;)
   <br>
   [&lt;Publisher: O&#x27;Reilly&gt;, &lt;Publisher: Apress&gt;]
   <br>
  </pre>
  <p class="cn" id="cn275">
   每次都要用
   <tt class="docutils literal">
    <span class="pre">
     order_by()
    </span>
   </tt>
   显得有点嗦。 大多数时间你通常只会对某些 字段进行排序。 在这种情况下，Django让你可以指定模型的缺省排序方式：
  </p>
  <pre class="cn literal-block" id="cn277">   class Publisher(models.Model):
   <br>
   name = models.CharField(max_length=30)
   <br>
   address = models.CharField(max_length=50)
   <br>
   city = models.CharField(max_length=60)
   <br>
   state_province = models.CharField(max_length=30)
   <br>
   country = models.CharField(max_length=50)
   <br>
   website = models.URLField()
   <br>
   <br>
   def __unicode__(self):
   <br>
   return self.name
   <br>
   <br>
   **class Meta:**
   <br>
   **ordering = [&#x27;name&#x27;]**
   <br>
  </pre>
  <p class="cn" id="cn278">
   现在，让我们来接触一个新的概念。
   <tt class="docutils literal">
    <span class="pre">
     class
    </span>
    <span class="pre">
     Meta
    </span>
   </tt>
   ，内嵌于
   <tt class="docutils literal">
    <span class="pre">
     Publisher
    </span>
   </tt>
   这个类的定义中（如果
   <tt class="docutils literal">
    <span class="pre">
     class
    </span>
    <span class="pre">
     Publisher
    </span>
   </tt>
   是顶格的，那么
   <tt class="docutils literal">
    <span class="pre">
     class
    </span>
    <span class="pre">
     Meta
    </span>
   </tt>
   在它之下要缩进4个空格－－按 Python 的传统 ）。你可以在任意一个 模型 类中使用
   <tt class="docutils literal">
    <span class="pre">
     Meta
    </span>
   </tt>
   类，来设置一些与特定模型相关的选项。 在 附录B 中有
   <tt class="docutils literal">
    <span class="pre">
     Meta
    </span>
   </tt>
   中所有可选项的完整参考，现在，我们关注
   <tt class="docutils literal">
    <span class="pre">
     ordering
    </span>
   </tt>
   这个选项就够了。 如果你设置了这个选项，那么除非你检索时特意额外地使用了
   <tt class="docutils literal">
    <span class="pre">
     order_by()
    </span>
   </tt>
   ，否则，当你使用 Django 的数据库 API 去检索时，
   <tt class="docutils literal">
    <span class="pre">
     Publisher
    </span>
   </tt>
   对象的相关返回值默认地都会按
   <tt class="docutils literal">
    <span class="pre">
     name
    </span>
   </tt>
   字段排序。
  </p>
 </div>
 <div class="section" id="id16">
  <h3 class="cn" id="cn279">
   连锁查询
  </h3>
  <p class="cn" id="cn280">
   我们已经知道如何对数据进行过滤和排序。 当然，通常我们需要同时进行过滤和排序查询的操作。 因此，你可以简单地写成这种“链式”的形式：
  </p>
  <pre class="cn literal-block" id="cn282">   &gt;&gt;&gt; Publisher.objects.filter(country=&quot;U.S.A.&quot;).order_by(&quot;-name&quot;)
   <br>
   [&lt;Publisher: O&#x27;Reilly&gt;, &lt;Publisher: Apress&gt;]
   <br>
  </pre>
  <p class="cn" id="cn283">
   你应该没猜错，转换成SQL查询就是
   <tt class="docutils literal">
    <span class="pre">
     WHERE
    </span>
   </tt>
   和
   <tt class="docutils literal">
    <span class="pre">
     ORDER
    </span>
    <span class="pre">
     BY
    </span>
   </tt>
   的组合：
  </p>
  <pre class="cn literal-block" id="cn285">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   WHERE country = &#x27;U.S.A&#x27;
   <br>
   ORDER BY name DESC;
   <br>
  </pre>
 </div>
 <div class="section" id="id17">
  <h3 class="cn" id="cn286">
   限制返回的数据
  </h3>
  <p class="cn" id="cn287">
   另一个常用的需求就是取出固定数目的记录。 想象一下你有成千上万的出版商在你的数据库里， 但是你只想显示第一个。 你可以这样做：
  </p>
  <pre class="cn literal-block" id="cn289">   &gt;&gt;&gt; Publisher.objects.order_by(&#x27;name&#x27;)[0]
   <br>
   &lt;Publisher: Apress&gt;
   <br>
  </pre>
  <p class="cn" id="cn290">
   这相当于：
  </p>
  <pre class="cn literal-block" id="cn292">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   ORDER BY name
   <br>
   LIMIT 1;
   <br>
  </pre>
  <p class="cn" id="cn293">
   类似的，你可以用python的range-slicing语法来取出数据的特定子集
  </p>
  <pre class="cn literal-block" id="cn295">   &gt;&gt;&gt; Publisher.objects.order_by(&#x27;name&#x27;)[0:2]
   <br>
  </pre>
  <p class="cn" id="cn296">
   这个例子返回两个对象，等同于以下的SQL语句：
  </p>
  <pre class="cn literal-block" id="cn298">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   ORDER BY name
   <br>
   OFFSET 0 LIMIT 2;
   <br>
  </pre>
  <p class="cn" id="cn299">
   注意，不支持Python的负索引(negative slicing)：
  </p>
  <pre class="cn literal-block" id="cn301">   &gt;&gt;&gt; Publisher.objects.order_by(&#x27;name&#x27;)[-1]
   <br>
   Traceback (most recent call last):
   <br>
   ...
   <br>
   AssertionError: Negative indexing is <b style="color:black;background-color:#ff9999">not</b> supported.
   <br>
  </pre>
  <p class="cn" id="cn302">
   虽然不支持负索引，但是我们可以使用其他的方法。 比如，稍微修改 order_by() 语句来实现：
  </p>
  <pre class="cn literal-block" id="cn304">   &gt;&gt;&gt; Publisher.objects.order_by(&#x27;-name&#x27;)[0]
   <br>
  </pre>
 </div>
 <div class="section" id="id18">
  <h3 class="cn" id="cn305">
   更新多个对象
  </h3>
  <p class="cn" id="cn306">
   在“插入和更新数据”小节中，我们有提到模型的save()方法，这个方法会更新一行里的所有列。 而某些情况下，我们只需要更新行里的某几列。
  </p>
  <p class="cn" id="cn307">
   例如说我们现在想要将Apress Publisher的名称由原来的”Apress”更改为”Apress Publishing”。若使用save()方法，如：
  </p>
  <pre class="cn literal-block" id="cn309">   &gt;&gt;&gt; p = Publisher.objects.get(name=&#x27;Apress&#x27;)
   <br>
   &gt;&gt;&gt; p.name = &#x27;Apress Publishing&#x27;
   <br>
   &gt;&gt;&gt; p.save()
   <br>
  </pre>
  <p class="cn" id="cn310">
   这等同于如下SQL语句：
  </p>
  <pre class="cn literal-block" id="cn312">   SELECT id, name, address, city, state_province, country, website
   <br>
   FROM books_publisher
   <br>
   WHERE name = &#x27;Apress&#x27;;
   <br>
   <br>
   UPDATE books_publisher SET
   <br>
   name = &#x27;Apress Publishing&#x27;,
   <br>
   address = &#x27;2855 Telegraph Ave.&#x27;,
   <br>
   city = &#x27;Berkeley&#x27;,
   <br>
   state_province = &#x27;CA&#x27;,
   <br>
   country = &#x27;U.S.A.&#x27;,
   <br>
   website = &#x27;http://www.apress.com&#x27;
   <br>
   WHERE id = 52;
   <br>
  </pre>
  <p class="cn" id="cn313">
   （注意在这里我们假设Apress的ID为52）
  </p>
  <p class="cn" id="cn314">
   在这个例子里我们可以看到Django的save()方法更新了不仅仅是name列的值，还有更新了 所有的列。 若name以外的列有可能会被其他的进程所改动的情况下，只更改name列显然是更加明智的。 更改某一指定的列，我们可以调用结果集（QuerySet）对象的update()方法： 示例如下：
  </p>
  <pre class="cn literal-block" id="cn316">   &gt;&gt;&gt; Publisher.objects.filter(id=52).update(name=&#x27;Apress Publishing&#x27;)
   <br>
  </pre>
  <p class="cn" id="cn317">
   与之等同的SQL语句变得更高效，并且不会引起竞态条件。
  </p>
  <pre class="cn literal-block" id="cn319">   UPDATE books_publisher
   <br>
   SET name = &#x27;Apress Publishing&#x27;
   <br>
   WHERE id = 52;
   <br>
  </pre>
  <p class="cn" id="cn320">
   update()方法对于任何结果集（QuerySet）均有效，这意味着你可以同时更新多条记录。 以下示例演示如何将Publisher的country字段值为’U.S.A’更改为’USA’：
  </p>
  <pre class="cn literal-block" id="cn322">   &gt;&gt;&gt; Publisher.objects.all().update(country=&#x27;USA&#x27;)
   <br>
   2
   <br>
  </pre>
  <p class="cn" id="cn323">
   update()方法会返回一个整型数值，表示受影响的记录条数。 在上面的例子中，这个值是2。
  </p>
 </div>
</div>
<div class="section" id="id19">
 <h2 class="cn" id="cn324">
  删除对象
 </h2>
 <p class="cn" id="cn325">
  删除数据库中的对象只需调用该对象的delete()方法即可：
 </p>
 <pre class="cn literal-block" id="cn327">  &gt;&gt;&gt; p = Publisher.objects.get(name=&quot;O&#x27;Reilly&quot;)
  <br>
  &gt;&gt;&gt; p.delete()
  <br>
  &gt;&gt;&gt; Publisher.objects.all()
  <br>
  [&lt;Publisher: Apress Publishing&gt;]
  <br>
 </pre>
 <p class="cn" id="cn328">
  同样我们可以在结果集上调用delete()方法同时删除多条记录。这一点与我们上一小节提到的update()方法相似：
 </p>
 <pre class="cn literal-block" id="cn330">  &gt;&gt;&gt; Publisher.objects.filter(country=&#x27;USA&#x27;).delete()
  <br>
  &gt;&gt;&gt; Publisher.objects.all().delete()
  <br>
  &gt;&gt;&gt; Publisher.objects.all()
  <br>
  []
  <br>
 </pre>
 <p class="cn" id="cn331">
  删除数据时要谨慎！ 为了预防误删除掉某一个表内的所有数据，Django要求若要删除表内所有数据时要使用all()来明确指定。 比如，下面的操作将会出错：
 </p>
 <pre class="cn literal-block" id="cn333">  &gt;&gt;&gt; Publisher.objects.delete()
  <br>
  Traceback (most recent call last):
  <br>
  File &quot;&lt;console&gt;&quot;, line 1, in &lt;module&gt;
  <br>
  AttributeError: &#x27;Manager&#x27; object has no attribute &#x27;delete&#x27;
  <br>
 </pre>
 <p class="cn" id="cn334">
  而一旦使用all()方法，所有数据将会被删除：
 </p>
 <pre class="cn literal-block" id="cn336">  &gt;&gt;&gt; Publisher.objects.all().delete()
  <br>
 </pre>
 <p class="cn" id="cn337">
  如果只需要删除部分的数据，就不需要调用all()方法。再看一下之前的例子：
 </p>
 <pre class="cn literal-block" id="cn339">  &gt;&gt;&gt; Publisher.objects.filter(country=&#x27;USA&#x27;).delete()
  <br>
 </pre>
</div>
	  </div>

	  <div class="blog-detail-btn btn-area-center" id="id_blog_button_field">
	    



<a class="SG_aBtn" href="javascript:void(0);" onclick="javascript:ShareModule.do_share(this, 17, 2143);return false;" resource_sn="2143" resource_type="17"><cite>分享</cite></a>





	    
	    





<a class=" SG_aBtn" href="#" id="add-to-desktop-17-2143" link_sn="None" onclick="javascript:DesktopModule.add(this);return false;" resource_sn="2143" resource_type="17" userid=""><cite>添加到桌面</cite></a><a class=" SG_aBtn" href="#" id="delete-from-desktop-17-2143" link_sn="None" onclick="javascript:DesktopModule.remove(this); return false;" resource_sn="2143" resource_type="17" style="display:none;" userid=""><cite>从桌面删除</cite></a>



	  </div>
	</div>
      </div>
      
      <!-- like section -->
      <div style="margin-left:13px;margin-right:13px;">
	<div id="id_like_container"></div>
      </div>

      <!-- show comment -->
      <div style="margin-left:13px;margin-right:13px;">
	<h2 class="zeuux-h2 zeuux-h2-nobottom" id="comment-start">评论</h2>
      </div>

      
      <div class="comment-content-all" id="id_comment_content_all" style="margin-bottom:20px;clear:both;">
  
  <div class="post-comment-static-div zeuux-comment" id="id_post_comment_div_17_" style="margin-top:10px;padding-bottom:10px;">
    <form action="#" class="post-comment-form" id="id_post_comment_form" resource_type="17">
      


<div class="zeuux-mwin mwin-failed  small-mwin hide " id="id_post_comment_form_error" style="width:250px;">
	
	<a class="close" href="#" onclick="javascript:NoticeModule.close(this);return false;"><img src="zeuux-trns.gif"></a>
	<span class="mwin-body"></span>
	
</div>
	
      <p class="title">
	我的评论：
      </p>
      <textarea class="comment-content-field comment-textarea inp_base inp_disabled" disabled="disabled" id="id_post_comment_content_17" name="comment_content" rows="6" style="width:687px;"></textarea>
      <input name="comment_action_type" type="hidden" value="direct_comment">
      <p class="comment-chk">
	<input disabled="disabled" id="id_comment_is_anonymous" name="comment_is_anonymous" type="checkbox" value="8"><label for="id_comment_is_anonymous">匿名身份</label></p>
      <p class="comment-submit">
	
	<a class="comment-submit-button SG_aBtn SG_aBtnc SG_aBtn_dis" href="javascript:void(0);" id="id_comment_submit_button" onclick="javascript:if(FormModule.is_enabled(this))jQuery(&#x27;#id_post_comment_form&#x27;).submit();return false;"><cite>发表评论</cite></a>
	
      </p>
      
      <div style="position:relative;top:-135px;text-align:center;font-size:14px;">请&#xa0;<a class="bold" href="/login/?referer=index.jpgblog/content/2143/">登录</a>&#xa0;后发表评论。还没有在Zeuux哲思注册吗？现在&#xa0;<a class="bold" href="/register/?referer=index.jpgblog/content/2143/">注册</a>&#xa0;！</div>
      
      <input name="comment_resource_sn" type="hidden" value="2143">
      <input name="comment_resource_owner" type="hidden" value="6775">
      <input name="comment_resource_type" type="hidden" value="17">
      <input name="comment_page_size" type="hidden" value="20">
      <input name="comment_sort_type" type="hidden" value="0">	
      <input name="comment_template_style" type="hidden" value="1">	
    </form>
  </div>
  <div class="zeuux-board">
    <div class="comment-body" id="id_comment_body" style="overflow:auto;">
      
      
<div class="comment-list" id="id_comment_list_div_17_20019" userid="5bf62a5e5ade4b64b825dfe238fac04c"> 
  <div class="user-feed-comment zeuux-board-cell    ">
	  <div class="comment-ori-info"> 
		<div class="avatars comment-icon">

<a href="http://www.zeuux.com/home/5bf62a5e5ade4b64b825dfe238fac04c/"><img alt="durong" src="http://style.zeuux.com/style/base/images/default-head-2-small.gif" style="border:0;" title="去durong的个人主页"></a>



		</div>
		<div class="txt"> 
		  <h4 class="zeuux-h4">
			<span class="option SG_floatR">
			  
			  
			  
			  <a comment_sn="20019" href="javascript:void(0);" onclick="javascript:get_dyna_reply_form(this);return false;" page_size="20" resource_owner="6775" resource_sn="2143" resource_type="17" sort_type="0" template_style="1">回复</a>
			  
			</span>
			<span class="comment-username">
<a class="username" href="http://www.zeuux.com/home/5bf62a5e5ade4b64b825dfe238fac04c/" title="durong" userid="5bf62a5e5ade4b64b825dfe238fac04c">durong</a>

</span>&#xa0;<span class="time">2015年07月02日 星期四 11:38</span>
		  </h4>
		  <div class="txt-m" style="margin-bottom: 10px;">
			<div class="comment-content" style="width:635px;_width:615px;overflow-x:hidden; ">
			  您好，觉得<wbr>你总结的非<wbr>常精彩，想<wbr>跟你请教一<wbr>个问题，关<wbr>于obje<wbr>cts.a<wbr>ll（），<wbr>我跟你一样<wbr>设定了_u<wbr>nicod<wbr>e_方法，<wbr>可是不能正<wbr>常显示出来<wbr>内容，只能<wbr>显示出对象<wbr>来，如下：<wbr>model<wbr>ls.py<wbr>内容为：<br><wbr>from django.db import models<br><br>class Emplo<wbr>yee(m<wbr>odels<wbr>.Mode<wbr>l):<br><br><wbr>    name=<wbr>model<wbr>s.Cha<wbr>rFiel<wbr>d(max<wbr>_leng<wbr>th=20<wbr>)<br><br>    def _unicode_(self):<br>        return self.<wbr>name<br><wbr>然后交互界<wbr>面输入了相<wbr>关的数据，<wbr><br>但是<br><br><wbr>In [1]: from blog.models import Employee<br><br>In [2]: emps = Emplo<wbr>yee.o<wbr>bject<wbr>s.all<wbr>()<br>In<wbr> [12]: emps<br>Out[12]: [&lt;Employee: Employee object&gt;, &lt;Employee: Employee object&gt;, &lt;Employee: Employee object&gt;, &lt;Employee: Employee object&gt;, &lt;Employee: Employee object&gt;, &lt;Employee: Employee objec<wbr>t&gt;]<br><br><wbr>急求，希望<wbr>您看到回复<wbr>能给我发个<wbr>邮件 谢谢 邮箱号为4<wbr>53804<wbr>356@q<wbr>q.com<wbr>
			</div>
			<p>
			  
			  <a class="has-reply ex reply-open hide total-reply-link" comment_sn="20019" href="#" onclick="javascript:show_child_reply(this);return false;" parent_sn="0" resource_type="17"><span class="child-comment-counter" comment_sn="20019" parent_sn="0">0</span>条回复</a>
			  
			</p>
		  </div>
		</div>
	</div>
  </div>
  <ul id="id_child_comment_div_17_20019">
    <div class="child-comment"></div>
  </ul>
</div>

<div class="comment-list" id="id_comment_list_div_17_19901" userid="xiawu"> 
  <div class="user-feed-comment zeuux-board-cell    ">
	  <div class="comment-ori-info"> 
		<div class="avatars comment-icon">

<a href="http://www.zeuux.com/home/xiawu/"><img alt="夏武" src="index.jpg" style="border:0;" title="去夏武的个人主页"></a>



		</div>
		<div class="txt"> 
		  <h4 class="zeuux-h4">
			<span class="option SG_floatR">
			  
			  
			  
			  <a comment_sn="19901" href="javascript:void(0);" onclick="javascript:get_dyna_reply_form(this);return false;" page_size="20" resource_owner="6775" resource_sn="2143" resource_type="17" sort_type="0" template_style="1">回复</a>
			  
			</span>
			<span class="comment-username">
<a class="username" href="http://www.zeuux.com/home/xiawu/" title="夏武" userid="xiawu">夏武</a>

</span>&#xa0;<span class="time">2012年05月12日 星期六 11:16</span>
		  </h4>
		  <div class="txt-m" style="margin-bottom: 10px;">
			<div class="comment-content" style="width:635px;_width:615px;overflow-x:hidden; ">
			  不错
			</div>
			<p>
			  
			  <a class="has-reply ex reply-open hide total-reply-link" comment_sn="19901" href="#" onclick="javascript:show_child_reply(this);return false;" parent_sn="0" resource_type="17"><span class="child-comment-counter" comment_sn="19901" parent_sn="0">0</span>条回复</a>
			  
			</p>
		  </div>
		</div>
	</div>
  </div>
  <ul id="id_child_comment_div_17_19901">
    <div class="child-comment"></div>
  </ul>
</div>

      
    </div>
    
<div class="zeuux-mwin  hide " id="id_no_comment_notice">
	
  	<div class="body">
		<table>
	  		<tbody><tr>
				<td class="icon">
		  			<img align="absmiddle" src="http://style.zeuux.com/style/classic/images/zeuux-mwin1.png">
				</td>
				<td>
		  			<p class="txt mwin-body">暂时没有评论</p>
				</td>
	  		</tr>
		</tbody></table>
  	</div>
  	
</div>



  </div>

  <span id="id_comment_body_pages">
    
  </span>
  
</div>
      

      
      
    </div>
    
  </div>
  
</div>

		  </div>
		</div>
		
	  </div>
	  
	  
	  
	  <div class="zeuux-footer" style="background:none;border-top:1px solid #999;">
	    
	    <span class="fleft">Zeuux&#xa0;
